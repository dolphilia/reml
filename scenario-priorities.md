# Reml に求められる横断的な拡張領域

`scenario-requirements.md` で整理した各シナリオを俯瞰し、Reml の設計哲学（`0-1-overview.md` / `0-2-project-purpose.md`）と照らし合わせた結果、特に汎用性が高く、かつ "Reml らしさ"（宣言的 DSL、型安全、ツールフレンドリーさ、Unicode 前提、優れたエラー診断）を伸ばせる領域を抽出した。以下では、利用シナリオを根拠として重視すべき仕様・機能を列挙する。

---

## 1. 宣言的 DSL を成立させる型安全な設定／構成言語
- **重要性**: Webフレームワークのテンプレート・ルーティング、クラウドインフラの IaC、ビルドシステム、IDE 設定など、ほぼすべてのシナリオで「宣言で終わる操作性」が鍵になっている。
- **要件**
  - スキーマ定義＋差分検証（クラウドインフラ、データベース設定、Web ルーティング）。`ConfigSchemaOptions.data_source` と `RunConfig.data_profile` を利用した品質設定の一元化。
  - Unicode を含むキー・文字列の扱い（国際化された Web テンプレート、データパイプライン）。
  - 型安全な定数・式・条件分岐（ビルドシステムのプロファイル切替、IDE 設定のプラットフォーム差分）。

## 2. 高精度なエラー診断とリカバリ支援
- **重要性**: Reml の差別化要素であり、IDE 連携やクラウドポリシー、セキュリティ DSL、データ品質検査など、入力ミスが運用コストに直結する領域で価値が高い。
- **要件**
  - 期待集合と FixIt を用いた修正提案（IDE 設定、Web テンプレート、クラウド IAM ポリシー）。`StreamDiagnosticHook`・`QualityReport` の JSON スキーマで統一。
  - 変更履歴／監査ログ連携（クラウドインフラ、エンタープライズワークフロー、ネットワークポリシー）。`gc.stats`・`reml.data.quality` など共通ドメインでログ化。
  - サブシステムごとのエラー分類（データ品質 DSL、ビルド失敗、リアルタイム制約違反）。`GcReason`・`ContinuationMeta.expected_tokens` による診断を含む。

## 3. モジュール化された拡張ポイント（DSL プラグイン）
- **重要性**: 各シナリオで独自の構文・演算子が求められ、共通基盤に拡張ポイントを設けることで「小さく強いコア」を保ちつつドメイン DSL を載せられる。
- **要件**
  - Parser/コンビネータの再利用を前提とした DSL プラグイン構造（Web テンプレート、ビルドスクリプト、HDL、IaC）。
  - バックエンド連携を切り替える抽象化（データパイプラインのランタイム、ML モデル定義、ネットワーク機器ベンダ）。
  - 拡張の安全境界とバージョン互換（クラウドプロバイダ、DBMS 方言、IDE プラグイン）。

## 4. ツール／エコシステムとのシームレスな連携
- **重要性**: `0-2-project-purpose.md` で掲げた「自力完結できるエコシステム」「ツールフレンドリーさ」を実現するためには、IDE、CI/CD、監視ツールなどとの連携が不可欠。多くのシナリオ（IDE 拡張、クラウド、データパイプライン、ML、ビルド）で共通要求。
- **要件**
  - LSP／IDE へのメタデータ出力（構文ハイライト、補完、エラー連携）。`StreamDriver`/`StreamEvent` を活用したリアルタイム差分も含める。
  - CLI/CI 用コマンドと構造化ログ（ビルド、データパイプライン、クラウド，Web）。`QualityReport`/`gc.stats` など JSON スキーマの互換性検証を必須化。
  - 監査・可観測性 API（クラウドポリシー、エンタープライズワークフロー、ML モデル監視）。`RuntimeCapabilities.metrics` を通じた一元収集。

## 5. 型システム拡張とデータモデリング
- **重要性**: ORM、データパイプライン、ML、DBMS、ビルド設定などで複雑な型が求められる。型推論で読みやすさを維持しつつ、ドメイン特有の型（テンソル、列型、ポリシー定義）を扱う必要がある。
- **要件**
  - ドメイン固有の型表現（テンソル、列型、リソース ID、リアルタイム制約、`StatType`）。
  - 型と効果の接続（クラウド操作、ML 学習、ネットワーク更新の副作用管理）。
  - スキーマ進化と差分生成（データベース、データパイプライン、レポート DSL）。

## 6. 実行基盤との橋渡し（FFI／ランタイム連携）
- **重要性**: Reml はドキュメントベースの仕様だが、実運用を視野に入れたツール開発を想定しており、各 DSL が外部ランタイムに安全に接続できることが鍵。ゲームエンジン、クラウドインフラ、ビルド、機械学習などで共通の要請。
- **要件**
  - FFI／IPC 境界の安全な抽象化（デバッガ制御、クラウド API、ML ランタイム、データベース）。`GcCapability` を含む Core.Runtime の拡張ポイントと整合させる。
  - 差分適用やデプロイ戦略の一貫化（IaC、ビルド、クラウド、組み込み）。`RunConfig.gc.profile` と `data_profile` を同じデプロイ計画に組み込む。
  - ホットリロードやインクリメンタル更新（ゲームスクリプト、IDE、クラウドテンプレート、データパイプライン）。`StreamDriver`/`QualityRule` を使った差分適用手順を共通化。

---

## まとめ
これら 6 項目は、扱うドメインが異なっても共通して求められる「型安全な宣言 DSL」「強力なエラー診断」「拡張可能なパーサ基盤」「ツール連携」「複雑な型と効果の管理」「実行基盤との接続」を包含している。Reml が掲げる設計哲学（簡潔さ／読みやすさ／エラー品質／Unicode 前提）と `0-2-project-purpose.md` のゴール（実用性能、自力完結エコシステム、ツールフレンドリーさ）に合致しながら、さまざまなシナリオを横断的に支える基盤となる。
