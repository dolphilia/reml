# Remlソースコード完全解説: 概要

## 1. プロジェクトの目的

本プロジェクトの目的は、Remlプログラミング言語コンパイラのための包括的な「ソースコード解説（Source Code Commentary）」を作成することです。このドキュメントは、Remlの内部動作を深く掘り下げ、開発者が言語の核心となる実装を理解し、修正し、貢献できるようにすることを目的としています。

以下の古典的な技術解説書のような深さと明確さを目指します。

- 『Lions’ Commentary on Unix（Lions' Commentary on Unix 6th Edition, with Source Code）』
- 『Linux Core Kernel Commentary』
- 『Rubyソースコード完全解説（Ruby Hacking Guide）』

## 2. 想定読者

- **経験レベル**: 一般的なプログラミング経験があり、少なくとも1つのシステムプログラミング言語に習熟していること。
- **Rustの知識**: 中級レベル。アプリケーションを書くことができ、所有権や借用（borrowing）を理解しているが、Unsafe Rust、FFI、LLVMバインディング、複雑なマクロシステムなどの高度なトピックについては学習中の可能性がある。
- **目標**: Remlのコアコントリビューターになること、あるいは教育目的でコンパイラの内部構造を理解すること。

## 3. スコープ

解説はRemlリポジトリの `compiler/` ディレクトリに焦点を当てます。

- **Frontend**: レキサー、パーサー、AST、型チェッカー、意味解析、診断、パイプライン。
- **Runtime**: 標準ライブラリの基盤、Capability/IO/Text/Parse、FFIブリッジ、実行サポート。
- **Backend**: LLVMへのラウアリング（lowering）とコード生成、ランタイム連携。
- **Adapter**: プラットフォーム差異吸収レイヤ（Env/FS/Network/Time/Random/Process/Target）。
- **Tooling**: `xtask`、`ffi_bindgen`、CLIドライバや監査支援。

## 4. ドキュメンテーションの哲学

- **「コードこそが真実」**: テキストは常に具体的なファイルとコード行を参照するべきである。
- **トップダウンとボトムアップ**:
  - ハイレベルなアーキテクチャから始める（トップダウン）。
  - その後、特定のモジュールを深く掘り下げる（ボトムアップ）。
  - 最後に、ソースからバイナリまでの単一プログラムの実行をトレースする（エンドツーエンド）。
- **教育的**: コードが「何」をしているかだけでなく、「なぜ」その設計上の決定がなされたかを説明する。コンパイラで使用されているRustのパターン（例：Visitorパターン、Arenaアロケーション）を強調する。

## 5. 成果物と品質基準

- **成果物**: 章立てされた解説書、図解（Mermaid）、索引（用語・モジュール対応表）、エンドツーエンドの実行トレース。
- **品質基準**:
  - 全章が具体的なファイル/関数参照を含む。
  - 主要モジュールは「入力/出力/責務/依存関係/典型的な実行経路」を説明できる。
  - 仕様（`docs/spec`）との対応関係を章末で確認できる。

## 6. 進め方（調査→執筆）

1. **全体像の取得**: `compiler/README.md` と各 `compiler/*/README.md` を読み、担当領域を理解する。
2. **対応表の確定**: `docs/plans/source-code-commentary/1-2-module-spec-mapping.md` を起点に、章の候補と spec 節の対応を確定する（要確認の項目は先に解消）。
3. **章の優先度付け**: 学習コストと依存関係に基づき、章の執筆順を決める（例: 字句解析→構文解析→診断→型推論→意味解析→パイプライン）。
4. **モジュール単位の調査**: 章ごとに入口ファイル（mod.rs/lib.rs）から読み、主要型・関数・責務をメモ化する。
5. **実装トレースの作成**: 代表的な入力（最小のRemlコード、または `reml_frontend` のCLI）を選び、どの関数を経由するかを追跡する。
6. **仕様との照合**: 対応する `docs/spec` 節と照合し、差分があれば注記・課題化する。
7. **章草稿の作成**: `1-1-writing-guidelines.md` の章テンプレートに沿って、概要→データ構造→アルゴリズム→エラー→発展→章末まとめを埋める。
8. **図の追加**: データフローや構造が複雑な箇所は Mermaid 図を追加し、図番号・命名規則を付与する。
9. **相互参照の整備**: 他章への導線（次に読むべきモジュール、関連する spec）を章末に明示する。
10. **検証と更新**: 実行結果やテストログと照らし、用語・振る舞い・依存関係の誤りを修正する。

より詳細な手順は `docs/plans/source-code-commentary/0-1-detailed-process.md` を参照する。

## 7. ディレクトリ構造

この解説のためのすべての計画書とドラフトは `docs/plans/source-code-commentary/` に保存されます。
