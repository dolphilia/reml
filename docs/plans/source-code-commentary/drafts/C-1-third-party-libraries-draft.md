# 付録C: サードパーティライブラリ一覧

Reml コンパイラの実装において、すべての機能をゼロから実装するのではなく、エコシステムで成熟した高品質なクレート（ライブラリ）を積極的に活用しています。本付録では、`compiler/` 以下の各クレートで依存している主要なサードパーティライブラリについて、その採用目的と役割を解説します。

なお、ここで挙げるライブラリは `Cargo.toml` の `dependencies` に記載されている直接依存クレートを対象としています。

## C.1 テキスト処理・構文解析

コンパイラのフロントエンド処理や、実行時の文字列操作において中心的な役割を果たすライブラリ群です。

| クレート名 | 概要 | 採用理由 | 使用箇所 |
| --- | --- | --- | --- |
| **`chumsky`** | **パーサコンビネータ** | 表現力が高く、エラー回復（error recovery）機能に優れたパーサコンビネータライブラリです。Reml の構文解析器はこのライブラリを用いて構築されており、ユーザーフレンドリーな診断メッセージの生成に寄与しています。 | `frontend` |
| **`logos`** | **高速なレキサー生成** | 属性マクロを用いて Enum 定義から高速な字句解析器（Lexer）を生成します。パフォーマンスと記述の簡潔さを両立させるために採用しています。 | `frontend` |
| **`smol_str`** | **小規模文字列の最適化** | 識別子（Identifier）のような短い文字列を、ヒープ割り当てなしでスタック上に格納する最適化を行います（Small String Optimization）。AST のメモリ効率向上に寄与しています。 | `frontend` |
| **`regex`** | **正規表現エンジン** | 標準的な正規表現処理を提供します。Reml の標準ライブラリにおける正規表現機能の実装や、FFI バインディング生成時のフィルタリング処理などで利用されています。 | `runtime`, `ffi_bindgen` |
| **`unicode-ident`** | **Unicode識別子判定** | ソースコード内の識別子が Unicode Standard Annex #31 に準拠しているかを判定するために使用します。 | `frontend`, `runtime` |
| **`unicode-normalization`** | **Unicode正規化** | 文字列の等価比較を正しく行うための正規化処理（NFCなど）を提供します。 | `frontend`, `runtime` |
| **`unicode-width`** | **文字幅計算** | 端末への診断メッセージ出力において、各文字が占める表示幅（全角・半角など）を正しく計算し、レイアウトを整えるために使用します。 | `frontend`, `runtime` |
| **`unicode-segmentation`** | **書記素クラスタ分割** | 文字列を人間が認識する「文字」単位（Grapheme Cluster）で処理するために使用します。 | `runtime` |

## C.2 データ構造・アルゴリズム

標準ライブラリのコレクションを補完するデータ構造や、特定の数値計算・アルゴリズムを提供するライブラリ群です。

| クレート名 | 概要 | 採用理由 | 使用箇所 |
| --- | --- | --- | --- |
| **`indexmap`** | **順序保持ハッシュマップ** | 挿入順序を保持する Map / Set です。コンパイル結果の決定性（Determinism）を担保するため、辞書順やランダム順ではなく、意図した順序でデータを保持・反復する必要がある箇所で標準の `HashMap` の代わりに使用します。 | `frontend`, `runtime` |
| **`smallvec`** | **小規模ベクタの最適化** | 要素数が少ない場合にスタック領域を使用するベクタです。AST のノードなど、多くの場合に要素数が少ないリスト構造のメモリ効率を改善します。 | `frontend` |
| **`ordered-float`** | **順序付き浮動小数点数** | `f64` などを `Ord`トレイトに適合させ、`BTreeSet` や `HashMap` のキーとして利用可能にします。 | `runtime` |
| **`rust_decimal`** | **10進数演算** | 浮動小数点数誤差を許容しない金融計算などに適した10進数型を提供します（Reml の `Decimal` 型の実装）。 | `runtime` |
| **`num-bigint`** | **多倍長整数** | CPU のワードサイズを超える巨大な整数を扱うために使用します（Reml の `BigInt` 型の実装）。 | `runtime` |
| **`num-rational`** | **有理数** | 分数として数値を厳密に表現・計算するために使用します（Reml の `Ratio` 型の実装）。 | `runtime` |
| **`uuid`** | **UUID生成・操作** | 一意な識別子の生成に使用します。内部的なリソース管理や、標準ライブラリの UUID 機能のバックエンドとして利用されています。 | `frontend`, `runtime` |
| **`sha2`** | **ハッシュ関数** | SHA-2 ファミリーの暗号学的ハッシュ関数です。チェックサムの計算などに使用されます。 | `runtime`, `ffi_bindgen` |

## C.3 シリアライズ・設定・スキーマ

データの永続化、設定ファイルの読み書き、外部ツールとの連携に使用されるライブラリ群です。

| クレート名 | 概要 | 採用理由 | 使用箇所 |
| --- | --- | --- | --- |
| **`serde`** | **シリアライズ基盤** | Rust におけるデファクトスタンダードなシリアライズフレームワークです。多くの構造体で `Serialize` / `Deserialize` を導出し、JSON や TOML との相互変換を可能にしています。 | 全般 |
| **`serde_json`** | **JSON処理** | `reml_frontend` が出力する診断情報のフォーマットや、言語サーバとの通信など、JSON を扱うあらゆる箇所で利用されています。 | 全般 |
| **`toml`** | **TOML処理** | 設定ファイルやマニフェストファイルの解析に使用されています。 | `runtime`, `ffi_bindgen`, `xtask` |
| **`schemars`** | **JSON Schema生成** | Rust の型定義から JSON Schema を自動生成します。設定ファイルや出力フォーマットの仕様を外部ツール（VS Code 拡張機能など）に提供するために利用されます。 | `frontend`, `runtime` |

## C.4 システム・ランタイム・その他

OS とのインタラクション、エラー処理、実行環境の基盤となるライブラリ群です。

| クレート名 | 概要 | 採用理由 | 使用箇所 |
| --- | --- | --- | --- |
| **`thiserror`** | **エラー型定義の簡素化** | ライブラリのエラー型定義において、`Display` や `From` トレイトの実装を自動化し、ボイラープレートを削減するために広く採用しています。 | 全般 |
| **`once_cell`** | **遅延初期化** | グローバル変数や構造体のフィールドを、最初にアクセスされた時点で初期化する（Lazy Initialization）ために使用します（Rust 標準ライブラリの `std::sync::OnceLock` 安定化以前からの採用を含みます）。 | `frontend`, `runtime` |
| **`time`** | **日付・時刻処理** | 日付や時刻の操作、フォーマット、タイムゾーン処理などを提供します。Reml の標準ライブラリにおける日時機能のバックエンドです。 | `runtime` |
| **`notify`** | **ファイルシステム監視** | ファイルの変更イベントを検知するクロスプラットフォームなライブラリです。ホットリロード的な機能や、開発支援ツールでの利用を想定しています。 | `runtime` |
| **`glob`** | **パスパターンマッチング** | ファイルパスのパターン検索（グロブ展開）を提供します。 | `runtime` |
| **`getrandom`** | **乱数生成** | OS が提供するエントロピー源から安全に乱数を取得するための低レベルライブラリです。`adapter` レイヤで使用され、プラットフォームごとの差異を吸収します。 | `adapter` |
| **`wasmtime`** | **WebAssembly ランタイム** | WebAssembly (Wasm) モジュールを JIT コンパイルして実行するためのランタイムです。プラグインシステムや特定の安全な実行環境を提供するために利用されています。 | `runtime` |

## C.5 開発・テスト支援 (Dev Dependencies)

コンパイル時には含まれませんが、開発やテスト、ベンチマークにおいて重要な役割を果たすライブラリです。

| クレート名 | 概要 | 採用理由 |
| --- | --- | --- |
| **`insta`** | **スナップショットテスト** | テストの出力結果（実行結果やASTのダンプなど）をファイルとして保存し、変更があった場合に差分をレビューする形式のテストに使用します。期待値のメンテナンスコストを大幅に下げます。 |
| **`test-case`** | **パラメータ化テスト** | 一つのテスト関数に対して複数の入力パラメータを与えてテストを実行するための属性マクロを提供します。 |
| **`proptest`** | **プロパティベーステスト** | ランダムな入力を大量に生成し、関数の特性（プロパティ）が満たされているかを検証します。エッジケースの発見に役立ちます。 |
| **`criterion`** | **ベンチマーク** | 統計的に有意なパフォーマンス計測を行うためのベンチマークフレームワークです。 |
| **`tempfile`** | **一時ファイル作成** | テスト実行時に安全に一時ディレクトリや一時ファイルを作成・削除するために使用します。 |
| **`humantime`** | **時間表記のパース** | 人間が読みやすい形式の時間（例: "1s", "100ms"）をパースするために、主にベンチマークやテスト設定で使用します。 |
| **`static_assertions`** | **コンパイル時アサーション** | 構造体のサイズや型の性質など、コンパイル時に保証すべき条件をチェックするために使用します。 |
| **`wat`** | **WAT (WebAssembly Text) 解析** | テスト形式の WebAssembly (WAT) をバイナリに変換します。Wasm 関連のテストで使用されます。 |

---

**注**: 上記の情報は執筆時点（v0.1.0 開発中）のものであり、将来的にバージョンアップや他のライブラリへの置き換えが発生する可能性があります。最新の依存関係については、リポジトリ内の各 `Cargo.toml` を参照してください。
