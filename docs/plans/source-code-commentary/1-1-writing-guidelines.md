# Remlソースコード完全解説: 執筆ガイドライン

## 1. 言語とトーン

- **言語**: 日本語。
- **トーン**: 技術的で、教育的で、正確に。過度にカジュアルな言葉遣いは避けるが、無愛想になりすぎないこと。『オライリー・ジャパン』が出版する技術書のような、示唆に富んだ文章、理解しやすい言葉遣い、権威があり、しかし親しみやすいスタイルを採用する。
- **読者**: この特定のコードベースに初めて触れる同僚として扱う。

## 2. コード参照のフォーマット

- **ファイルパス**: 常にプロジェクトルートからの相対パスを使用する（例：`compiler/frontend/src/lexer/mod.rs`）。
- **関数名**: バッククォートを使用する（例：`Lexer::next_token`）。
- **行番号**: 可能な範囲で行番号を記載する（例：`compiler/frontend/src/lexer/mod.rs:120`）。
- **コードスニペット**:
  - スニペットは短く保つ（関連するロジックに集中する）。
  - 省略されたコードを示すには `...` を使用する。
  - 複雑な行を説明するためにコメントを追加する。
  - 長い関数は「入口→分岐→出口」の順に抜粋する。

## 3. 図解

すべての図に **Mermaid** を使用し、バージョン管理と編集を可能にする。

- **フローチャート**: データフロー用（例：Source -> Lexer -> Tokens）。
- **クラス図**: 構造体の関係用（例：`AST` の階層）。
- **シーケンス図**: 相互作用用（例：型推論のステップ）。
- **命名規則**: 図のタイトルに章番号と対象モジュールを含める（例：`図3-2 lexer token flow`）。

## 4. 章の構成テンプレート

各章は以下の一般的な構成に従うこと：

### 1. 概要 (Introduction)

- このモジュールは何か？
- なぜ存在するのか？
- 入力と出力は何か？

### 2. データ構造 (Key Data Structures)

- コアとなる構造体とEnum（例：`Token`, `Expr`）。
- メモリレイアウトの考慮事項。

### 3. アルゴリズムと実装 (Core Logic)

- メインループやエントリポイント。
- 主要なアルゴリズムのステップバイステップのウォークスルー。
- 特定の関数の参照。

### 4. エラー処理 (Error Handling)

- どのように失敗するか？
- 回復メカニズム（panic vs Result vs Diagnostic）。

### 5. 発展的トピック (Advanced Topics)

- 最適化。
- 他のモジュールとの関係。
- 将来の改善点。

### 6. 章末まとめ (Checkpoint)

- 読者が理解できたはずのポイントを箇条書きで3〜5個。
- 次章との接続点（どの関数/構造体に進むか）。

## 5. メンテナンス

- **バージョンの固定**: 解説のズレを防ぐため、特定のバージョンのReml/コミットをターゲットにする。解説の更新は特定のリリースにおけるタスクとするべきである。
- **仕様との同期**: `docs/spec` と差分が出た場合は明示的に注記し、解説の改訂タスクを起票する。
- **生成物の扱い**: 生成コードやビルド成果物は原則参照せず、必要な場合は生成手順を併記する。
