# 4.4 エコシステム移行計画

## 目的
- Phase 4 マイルストーン M3 に向け、パッケージレジストリ・プラグイン・ガイドをセルフホスト実装前提に更新し、コミュニティが新体制へ移行できるようにする。
- OCaml 実装は LTS として明示的に位置付けつつ、非推奨マークを付与し移行を促す。

## スコープ
- **含む**: レジストリ更新、プラグインガイド改訂、コミュニティ告知、移行支援ドキュメント。
- **含まない**: 新規パッケージの開発、コミュニティイベント。必要に応じて別計画。
- **前提**: リリースパイプラインとドキュメント更新が完了し、成果物が利用可能。

## 作業ブレークダウン

### 1. レジストリ更新計画（83週目前半）
**担当領域**: パッケージ配布基盤

1.1. **セルフホスト版パッケージの準備**
- 4-2 で生成された 3 ターゲット全ての成果物を収集
- パッケージメタデータの作成（[5-2-registry-distribution.md](../../spec/5-2-registry-distribution.md) §2 に準拠）
- `runtime_revision`、`stdlib_version`、`capabilities` の確認
- ハッシュと署名情報の検証

1.2. **レジストリへの登録**
- `POST /v1/publish` によるメタデータアップロード
- 3 ターゲット全てのアーティファクトのアップロード
- `publish_receipt` の取得と記録
- レジストリ側の検証（ABI互換性、Capability検証）

1.3. **OCaml 版の非推奨マーク付与**
- 既存 OCaml 版パッケージに `deprecated: true` フラグ追加
- 非推奨メッセージの設定（移行先情報を含む）
- `advisories` への移行告知追加
- ダウンロード統計の最終記録

1.4. **配布優先度の設定**
- Linux > Windows > macOS の優先度明示
- レジストリメタデータへの優先度情報追加
- ダウンロードページでの推奨ターゲット表示
- ミラー配信の優先順序設定

**成果物**: レジストリ登録済みセルフホスト版、非推奨マーク付きOCaml版、配布優先度設定

### 2. プラグイン・ブリッジガイド改訂（83週目後半）
**担当領域**: 開発者向けドキュメント

2.1. **guides/plugin-authoring.md の更新**
- セルフホスト版 ABI に基づくプラグイン開発手順
- OCaml 版からの移行ポイント（ABI差分、呼び出し規約）
- マルチターゲット対応の実装パターン
- Capability システムとの統合方法の詳細化

2.2. **guides/runtime-bridges.md の更新**
- セルフホスト版ランタイムブリッジの実装詳細
- ターゲット別の実装差分（Linux/Windows/macOS）
- FFI 契約の最新化（[3-9-core-async-ffi-unsafe.md](../../spec/3-9-core-async-ffi-unsafe.md) 準拠）
- デバッグ手法とトラブルシューティング

2.3. **コード例の更新**
- セルフホスト版で動作するサンプルコード作成
- マルチターゲット対応のサンプル追加
- CI 統合のサンプル（次ステップ）
- エラーハンドリング例の充実

2.4. **後方互換性ガイドの追加**
- OCaml 版との差異一覧
- 移行時の注意点（Breaking Changes）
- 互換レイヤの提供有無
- サポート終了スケジュールの明示

**成果物**: 更新済みプラグインガイド、ランタイムブリッジガイド、サンプルコード集

### 3. 移行ガイドと CI 設定サンプル作成（83-84週目）
**担当領域**: 移行支援資料

3.1. **移行ガイド文書の作成**
- `docs/guides/ocaml-to-selfhost-migration.md` の新規作成
- 移行手順のステップバイステップ説明
- チェックリスト形式の移行タスク
- よくある問題と解決策（FAQ形式）

3.2. **CI 設定サンプルの提供**
- GitHub Actions サンプル（3ターゲット対応）
- GitLab CI サンプル
- Jenkins サンプル（オプション）
- ローカルビルドスクリプトサンプル

3.3. **ターゲット別の移行手順**
- x86_64 Linux 移行手順
- Windows x64 移行手順
- ARM64 macOS 移行手順
- クロスコンパイル設定の移行

3.4. **移行検証ツールの提供**
- `reml migrate verify` コマンドの検討
- OCaml 版との出力比較スクリプト
- 診断メッセージ差分チェック
- 性能比較ツール

**成果物**: 移行ガイド、CI設定サンプル集、移行検証ツール

### 4. コミュニティ告知準備（84週目前半）
**担当領域**: 広報とコミュニケーション

4.1. **告知文草案の作成**
- セルフホスト版リリースの告知文
- OCaml 版非推奨化の説明
- 移行スケジュールの明示
- サポート体制の案内

4.2. **告知チャネルの準備**
- 公式サイトでの告知ページ作成
- フォーラム投稿案（コミュニティディスカッション用）
- メーリングリスト告知案
- ソーシャルメディア投稿案（Twitter/Mastodon等）

4.3. **FAQ の整備**
- セルフホスト版に関する FAQ
- 移行に関する FAQ（手順、期限、サポート）
- ターゲット対応に関する FAQ
- トラブルシューティング FAQ

4.4. **告知スケジュールの策定**
- 事前告知（Phase 4-3 完了時）
- 正式告知（Phase 4-4 完了時）
- フォローアップ告知（移行期間中の定期更新）
- 最終告知（OCaml版サポート終了前）

**成果物**: 告知文草案、FAQ、告知スケジュール、チャネル別投稿案

### 5. フォローアップ窓口整備（84週目後半）
**担当領域**: サポート体制

5.1. **問合せ窓口の設置**
- GitHub Discussions での専用カテゴリ作成
- メールサポートの体制整備
- チャット（Discord/Slack等）の検討
- 対応時間・SLA の定義

5.2. **サポート体制の構築**
- サポート担当者の割当
- エスカレーションフローの定義
- 対応優先度の設定（重大/通常/低優先度）
- 対応状況の追跡システム

5.3. **ナレッジベースの構築**
- よくある質問の蓄積
- トラブルシューティング事例集
- 移行成功事例の収集
- コミュニティ投稿のキュレーション

5.4. **フィードバック収集**
- 移行体験のアンケート作成
- 問題点の集約と優先順位付け
- 改善提案の収集
- コミュニティフィードバックの定期レビュー

**成果物**: サポート窓口、対応フロー、ナレッジベース、フィードバック収集システム

### 6. 外部プラグイン移行支援（84-85週目）
**担当領域**: エコシステム支援

6.1. **外部プラグインの棚卸し**
- 既存プラグインのリスト作成
- 利用状況の調査（ダウンロード数、アクティブユーザー）
- メンテナンス状況の確認
- 移行優先度の決定

6.2. **プラグイン開発者への通知**
- 個別通知メール送信
- 移行ガイドの提供
- 移行期限の案内
- サポート体制の説明

6.3. **移行支援の実施**
- 技術相談窓口の提供
- サンプルコードレビュー
- CI設定支援
- 互換性問題のトラブルシューティング

6.4. **互換レイヤの検討**
- OCaml版互換レイヤの必要性評価
- 提供範囲の決定（全機能 vs 主要機能のみ）
- 互換レイヤの実装（必要な場合）
- サポート期限の設定

**成果物**: プラグインリスト、開発者通知、移行支援記録、互換レイヤ（必要時）

### 7. 進捗記録とリスク管理（83-85週目、継続）
**担当領域**: プロジェクト管理

7.1. **移行状況の追跡**
- レジストリ登録状況の記録
- プラグイン移行率の追跡
- コミュニティフィードバックの集計
- 問合せ対応状況の記録

7.2. **メトリクス記録**
- `0-3-audit-and-metrics.md` への定期更新
- セルフホスト版のダウンロード統計
- OCaml版からの移行率
- サポート対応件数と平均解決時間

7.3. **リスク管理**
- 移行遅延リスクの評価
- 外部プラグインの移行遅延対応
- コミュニティからの反発への対応
- `0-4-risk-handling.md` への記録

7.4. **定期レビュー**
- 週次進捗レビュー
- ブロッカーの早期検出
- 対応策の迅速な実施
- レビュア承認記録

**成果物**: 進捗レポート、メトリクス記録、リスク台帳更新、レビュー記録

### 8. エコシステム移行完了判定（85週目）
**担当領域**: 完了検証

8.1. **移行完了基準の確認**
- レジストリでのセルフホスト版公開確認
- 主要ドキュメントの更新完了確認
- サポート体制の稼働確認
- コミュニティ告知の完了確認

8.2. **最終検証**
- 全ターゲットでのダウンロード・インストール検証
- CI設定サンプルの動作確認
- サポート窓口の機能確認
- FAQ・ナレッジベースの充実度確認

8.3. **フォローアップ計画**
- Phase 4-5、4-6 への引き継ぎ事項
- 継続監視項目の明示
- 長期サポート計画との連携
- 改善点の Phase 4 以降への反映

8.4. **完了報告**
- M3 マイルストーン達成報告書作成
- レビュアによる最終承認
- `0-3-audit-and-metrics.md` への記録
- 次フェーズへの準備確認

**成果物**: 移行完了報告書、最終検証記録、引き継ぎ資料、承認記録

## 成果物と検証
- レジストリでセルフホスト版が主要チャネルとして公開されている。
- ガイド・移行手順が整備され、コミュニティ告知が完了。
- フォローアップ事項が記録され、対応状況が追跡可能。

## リスクとフォローアップ
- 外部プラグインが移行に遅れる場合、互換レイヤやサポートデッドラインを設定。
- コミュニティからのフィードバックを迅速に取り込むため、`docs/notes/` に FAQ/事例集を追加。
- パッケージの署名・検証が未整備な場合、Phase 4 内で最優先事項として扱う。

## 参考資料
- [4-0-phase4-migration.md](4-0-phase4-migration.md)
- [5-2-registry-distribution.md](../../spec/5-2-registry-distribution.md)
- [guides/plugin-authoring.md](../../guides/plugin-authoring.md)
- [guides/runtime-bridges.md](../../guides/runtime-bridges.md)
- [0-3-audit-and-metrics.md](0-3-audit-and-metrics.md)
- [0-4-risk-handling.md](0-4-risk-handling.md)

