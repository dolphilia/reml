tag,trigger_sources,stage_requirement,capability_mapping,validation_hooks,spec_refs
diagnostic,"`tap_diag`/`emit` による診断送出、CLI/LSP/AuditSink からの publish、Config/Data/LSP で `Diagnostic` を返す全 API","`StageRequirement::AtLeast(beta)`（`compiler/frontend/src/typeck/env.rs` で `capability_stage_override` の既定が Beta、`StageRequirement::merged_with` が CLI からの上書きを合成）","`CapabilityDescriptor::resolve(\"diagnostic\")` の fallback が `id=diagnostic` を返し Stage=Beta を要求。`AuditEnvelope` と `StageAuditPayload` が `runtime_capabilities` を記録し、`AuditCapability.emit` に連結。","`scripts/validate-diagnostic-json.sh` の schema+必須キー検査（id/span/timestamp/audit）、`python3 tooling/ci/collect-iterator-audit-metrics.py --section diagnostics --require-success` の KPI を 1.0 で維持。","docs/spec/3-6-core-diagnostics-audit.md §1-§3, docs/spec/1-3-effects-safety.md §C, docs/plans/rust-migration/unified-porting-principles.md §9."
audit,"`AuditContext::log`、`audited_syscall`、`AuditSink` への書き込み、CLI/LSP の `--audit-level` オプション","`StageRequirement::AtLeast(beta)`（`capability_stage_override` の既定と `CapabilityDescriptor::resolve(\"core.diagnostics.audit_ctx.*\") -> id=audit`）","`AuditCapability.emit/status` と `AuditEnvelope.metadata` が必須キーを要求。`StageAuditPayload` が `effect.required_capabilities` / `actual_capabilities` を JSON へ展開。","`scripts/validate-diagnostic-json.sh` の `audit.*` 必須キー検査、`reports/audit/dashboard/*` と `collect-iterator-audit-metrics.py --section effects` で `audit_presence` を監視。","docs/spec/3-6-core-diagnostics-audit.md §3, §5, docs/spec/3-8-core-runtime-capability.md §4, docs/spec/1-3-effects-safety.md §C.2."
debug,"`Option/Result.expect`・`Core.Runtime` のデバッガ API・`core.io` のリソーストラッキング（`effect {debug}` 付き）","`StageRequirement::AtLeast(beta)`（`CapabilityDescriptor::resolve(\"core.debug.*\") -> id=debug` が Beta、`panic` 系のみ Experimental 扱い）を CLI で `StageId::Experimental` へ明示できる","`core.debug.*` / `panic` に束縛される効果は `CapabilityDescriptor` で `stage=experimental`（panic/unsafe/ffi/runtime）へ昇格。`StageAuditPayload` が CLI の `--effect-stage` と合成して `stage_trace` を生成。","`cargo test panic_forbidden` + `RUSTFLAGS=\"-Dnon-fmt-panics -Z panic-abort-tests\"`、`scripts/validate-diagnostic-json.sh --pattern core_prelude` による `core_prelude.panic_path` KPI、`reports/diagnostic-format-regression.md` の panic 監視。","docs/spec/3-1-core-prelude-iteration.md §2.2, docs/spec/3-5-core-io-path.md §4.5, docs/spec/3-8-core-runtime-capability.md §9.3, docs/spec/3-6-core-diagnostics-audit.md §0."
trace,"`register_dsl_metrics`/`record_dsl_*`、`start_dsl_span`/`finish_dsl_span`、`TraceContext` を扱う CLI/LSP 拡張","`StageRequirement::AtLeast(beta)`（`CapabilityDescriptor::resolve(\"core.trace.*\") -> id=trace`）＋ `StageContext.runtime`（`--effect-stage` や Registry）で `AtLeast(stable|beta)` を切替","`ExecutionMetricsScope` と `TraceContext` が `RuntimeCapability` と紐付き、`StageAuditPayload::bridge_signal` が `parser.stream.*` やトレース拡張を `extensions["bridge"]` へ反映。","`collect-iterator-audit-metrics.py --section streaming --case trace`（WIP）で `parser.stream.bridge_stage_propagation` を測定、`reports/dual-write/front-end/streaming_*` の trace JSON を `scripts/validate-diagnostic-json.sh --effect-tag trace` で部分検証予定。","docs/spec/3-6-core-diagnostics-audit.md §6, §6.1.1, §6.1.2, docs/spec/3-8-core-runtime-capability.md §4.1, docs/guides/runtime-bridges.md."
privacy,"`AuditPolicy.apply_policy`、`redact_pii`、CLI/LSP の `--anonymize-pii`、`privacy.redacted` メタデータの生成","`StageRequirement::AtLeast(beta)`（`CapabilityDescriptor::resolve(\"privacy\")` fallback）を将来的に `Exact(stage)` 指定可能。`StageAuditPayload` 経由で `AuditPolicy.level` に追記。","`AuditEnvelope.metadata` に `privacy.redacted` と対象フィールドを列挙し、`Diagnostic.extensions["privacy"]` へ `RedactPolicy` 由来の情報を同期。`AuditCapability` の `status` でポリシー違反を検知。","`scripts/validate-diagnostic-json.sh --effect-tag privacy`（本タスクで追加）で `privacy.*` キーを抽出、`reports/audit/privacy/`（Phase3 予定）と `collect-iterator-audit-metrics.py --section diagnostics --case privacy` で匿名化率を追跡。","docs/spec/3-6-core-diagnostics-audit.md §3.2, §4.1, docs/plans/bootstrap-roadmap/0-4-risk-handling.md, docs/spec/1-3-effects-safety.md §C.2."
