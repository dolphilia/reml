module,api,signature,effects,spec_ref,rust_impl_path,impl_status,notes
Core.IO,Reader::read,"fn read(&mut self, buf: &mut Bytes) -> Result<usize, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/reader.rs,Implemented (Rust runtime),Rust 版は `&mut [u8]` を受け取るが、`FsAdapter::ensure_read_capability()`→`record_io_operation()`→`take_io_effects_snapshot()` を一連で呼び出して `IoContext.bytes_processed`/`effect.stage.*` を埋め、`core_io.reader_writer_effects_pass_rate` が参照する `metadata.io.bytes_processed` を保証する。
Core.IO,Reader::read_exact,"fn read_exact(&mut self, size: usize) -> Result<Bytes, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/reader.rs,Implemented (Rust runtime),`read_exact_bytes`/`read_to_end` を Runtime に実装し、`Bytes::from_vec` + `UnicodeError` マッピングで `IoErrorKind::InvalidInput` を返す。`effect`/Capability トラッキングは `Reader::read` と共通で、`IoContext` のパス/バイト数転写も同一経路を利用。
Core.IO,Writer::write,"fn write(&mut self, buf: Bytes) -> Result<usize, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/writer.rs,Implemented (Rust runtime),`write_all`/`write_bytes` が `record_io_operation` と `take_io_effects_snapshot()` を必ず起動し、`IoContext.bytes_processed` と `CapabilityId = io.fs.write` を `IoError`/診断へ転写する。仕様上の `Bytes` API とは異なるが `Bytes` → `&[u8]` 変換ヘルパで吸収済み。
Core.IO,Writer::flush,"fn flush(&mut self) -> Result<(), IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/writer.rs,Implemented (Rust runtime),"`record_io_operation(0)` と `take_io_effects_snapshot()` を呼び出し、`IoContext.operation = ""flush""`／`effect.io_blocking_calls += 1` を診断に伝搬。`IoErrorKind::WriteZero`/`UnsupportedPlatform` も `operation_diagnostic_code` で `core.io.write_error` 扱いとなる。"
Core.IO,copy,"fn copy<R: Reader, W: Writer>(reader: &mut R, writer: &mut W) -> Result<u64, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/mod.rs,Implemented (Rust runtime),"Thread-Local `IoCopyBuffer`（64KiB）を共有し、`record_buffer_allocation/usage` で `effect {mem}` を測定。`err.map_context` で `IoContext.bytes_processed` を更新し、Remediation §4 で定義した `metadata.io.helper = ""copy""` 要件を CI（`core_io.reader_writer_effects_pass_rate`）で検証する。"
Core.IO,with_reader,"fn with_reader<T>(path: Path, f: (FileReader) -> Result<T, IoError>) -> Result<T, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/mod.rs,Implemented (Rust runtime),`FsAdapter::ensure_read_capability` + `record_io_operation`→`take_io_effects_snapshot()` の順で `IoContext` を構築し、`std::fs::File::open` 失敗時にも `path/capability/effects` を `IoError` へ接続。クロージャ完了後は `std::fs::File` の Drop で確実にクローズされる。
Core.IO,IoError,"type IoError = { kind: IoErrorKind, message: Str, path: Option<Path>, context: Option<IoContext> }",@pure,docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/error.rs,Implemented (Rust runtime),`IntoDiagnostic` が `extensions.io.*`（path/operation/capability/bytes_processed/buffer/watch/glob）と `extensions.effects.*` を出力し、`AuditEnvelope.metadata` に `io.*`/`io.effects.*` キーを展開。`PATH_GLOB_ERROR_CODE`/`WATCHER_ERROR_CODE` など operation 連動コードも実装済み。
Core.IO,IoErrorKind,enum IoErrorKind = { NotFound | PermissionDenied | ... },@pure,docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/error.rs,Implemented (Rust runtime),標準 I/O と `SecurityViolation`/`UnsupportedPlatform` を含むすべての `IoErrorKind` が定義され、`default_code()` で `core.io.*` 診断キーへ直接マッピング。`IoError::new`/`from_std` が `kind.as_str()` を JSON/Audit 双方へ書き出す。
Core.IO,IoContext,"type IoContext = { operation: Str, bytes_processed: Option<u64>, timestamp: Timestamp }",@pure,docs/spec/3-5-core-io-path.md#2-reader--writer-抽象,compiler/runtime/src/io/context.rs,Implemented (Rust runtime),"`operation/path/capability/bytes_processed/timestamp/effects/buffer/watch/glob` を保持し、`with_*`/`set_*` 系 API で Reader/Writer/File/Watcher/glob すべての診断フィールド（`metadata.io.*`, `metadata.effects.*`）を生成。`Core.Time::Timestamp` 連携と `BufferStats`/`WatchStats` も提供済み。"
Core.IO.File,File::open,"fn open(path: Path) -> Result<File, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/file.rs,Implemented (Rust runtime),"`FsAdapter::ensure_read_capability()` と `IoContext::new(""file.open"")` で `path/capability/timestamp` を記録し、`IoError::from_std` 経由で `core.io.file.open` 診断へ転写する。`core_io.file_ops_pass_rate` が JSON を監視。"
Core.IO.File,File::create,"fn create(path: Path, options: FileOptions) -> Result<File, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/file.rs,Implemented (Rust runtime),"`FileOptions` と `FsAdapter::ensure_{read,write}` / `ensure_permissions_modify()` を統合し、`CapabilityId = io.fs.write` + `fs.permissions.modify` を Stage チェック。`IoContext.operation = ""file.create""` を保持する。"
Core.IO.File,File::metadata,"fn metadata(path: Path) -> Result<FileMetadata, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/file.rs,Implemented (Rust runtime),`FileMetadata::from_std` が `Timestamp` と `FilePermissions` を抽出し、`FsAdapter::ensure_permissions_read()` を通じて `CapabilityId = fs.permissions.read` を検証。`metadata.io.file.*` を JSON へ固定。
Core.IO.File,File::remove,"fn remove(path: Path) -> Result<(), IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/file.rs,Implemented (Rust runtime),"`FsAdapter::ensure_write_capability()` 後に削除を実行し、`IoContext.operation = ""file.remove""` と `path` を記録。`core_io.file_ops_pass_rate` で POSIX/Windows ケースを監視。"
Core.IO.File,File::sync,"fn sync(file: &mut File) -> Result<(), IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/file.rs,Implemented (Rust runtime),"`sync_all`/`sync_data` が `record_fs_sync_operation()` と `fs_sync_effect_labels()` を呼び、`effect {fs.sync}` を `io.effects.fs_sync{,_calls}` に転写する。"
Core.IO.File,FileOptions,"type FileOptions = { read: Bool, write: Bool, append: Bool, truncate: Bool, permissions: Permissions }",@pure,docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/options.rs,Implemented (Rust runtime),ビルダー形式で `read`/`write`/`append`/`truncate`/`create`/`permissions` を設定し、`OpenOptions` へ適用。`FilePermissions`（Unix mode + Windows attributes）へ橋渡しする。
Core.IO.File,FileMetadata,"type FileMetadata = { size: u64, created: Timestamp, modified: Timestamp, permissions: Permissions }",@pure,docs/spec/3-5-core-io-path.md#3-ファイルとストリーム,compiler/runtime/src/io/metadata.rs,Implemented (Rust runtime),"`size`/`created_at`/`modified_at`/`permissions` を保持し、`Core.Time::Timestamp` を serde 互換で返す。`tests/golden/core_io/file_ops/metadata_basic_{unix,windows}.json` でゴールデン化。"
Core.IO.Buffer,BufferedReader,type BufferedReader<R: Reader>,effect {mem},docs/spec/3-5-core-io-path.md#31-ストリーミングとバッファ,compiler/runtime/src/io/buffered.rs,Implemented (Rust runtime),Thread-Local `IoCopyBuffer` と `IoContext.buffer` を導入し、`memory.buffered_io` Capability を `FsAdapter` で検証。`record_buffer_allocation` + `take_io_effects_snapshot()` により `effect {mem}` と `metadata.io.buffer.*` を常に記録する。
Core.IO.Buffer,buffered,"fn buffered<R: Reader>(reader: R, capacity: usize) -> BufferedReader<R>",effect {mem},docs/spec/3-5-core-io-path.md#31-ストリーミングとバッファ,compiler/runtime/src/io/buffered.rs,Implemented (Rust runtime),"容量 4KiB 未満は切り上げ、1MiB 超は `IoErrorKind::InvalidInput`。初期化時に `FsAdapter::ensure_buffered_io_capability()` を呼び、`IoContext.capability = ""memory.buffered_io""` と `buffer.capacity` を診断メタデータへ転写する。"
Core.IO.Buffer,read_line,"fn read_line(reader: &mut BufferedReader<Reader>) -> Result<Option<Str>, IoError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#31-ストリーミングとバッファ,compiler/runtime/src/io/buffered.rs,Implemented (Rust runtime),リングバッファの `fill_buf`/`consume` 状態管理で CR/LF/EOF を処理し、UTF-8 復号失敗時は `IoErrorKind::InvalidInput` + `IoContext` を返す。`record_buffer_usage(line.len())` で `effect {mem}` を継続計測。
Core.Path,path,"fn path(str: Str) -> Result<Path, PathError>",@pure,docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/mod.rs,Implemented (Rust runtime),"`Path`/`PathBuf`/`PathError` を実装し、空文字・NUL・UTF-8 を検証。`tests/path_normalize.rs` + `tests/data/core_path/normalize_{posix,windows}.json` で挙動を固定。"
Core.Path,join,"fn join(base: Path, segment: Str) -> Path",@pure,docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/mod.rs,Implemented (Rust runtime),`normalize_components` を共有して `.`/`..`/UNC/ドライブ差分を吸収し、`glob`/`security` からも流用。ゴールデン JSON で POSIX/Windows を比較済み。
Core.Path,parent,fn parent(path: Path) -> Option<Path>,@pure,docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/mod.rs,Implemented (Rust runtime),`PathBuf::parent` をラップし、`Option<Path>` を返すヘルパを公開。`tests/path_normalize.rs` の `parent_cases` で `/var` や `..\nested` を検証。
Core.Path,normalize,fn normalize(path: Path) -> Path,@pure,docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/mod.rs,Implemented (Rust runtime),`normalize_components` で絶対/相対・UNC・ドライブの差異を統一し、`cargo test normalize_and_join_follow_golden_cases` で回帰監視。
Core.Path,is_absolute,fn is_absolute(path: Path) -> Bool,@pure,docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/mod.rs,Implemented (Rust runtime),"`Path::is_absolute`/`PathBuf::is_absolute` を公開し、POSIX ルートと Windows ドライブ/UNC を `tests/data/core_path/normalize_{posix,windows}.json` でゴールデン化。"
Core.Path,glob,"fn glob(pattern: Str) -> Result<List<Path>, PathError>","effect {io, io.blocking}",docs/spec/3-5-core-io-path.md#4-path-抽象,compiler/runtime/src/path/glob.rs,Implemented (Rust runtime),"`glob.rs` で `glob` crate を用いてパターン列挙を実装し、`FsAdapter::ensure_read_capability()` を通じて `io.fs.read` Capability を検証。結果は `PathBuf` へ正規化した上でソートし、パターン/IO エラーは `PathErrorKind::{InvalidPattern,Io}` で報告する。`tests/path_glob.rs` + `tests/data/core_path/glob_{posix,windows}.json` + `tests/fixtures/path_glob/*` をゴールデンとして整備し、Plan 3-5 §3.1-§3.3 / Remediation §3 に成果を反映。"
Core.Path.Security,validate_path,"fn validate_path(path: Path, policy: SecurityPolicy) -> Result<Path, SecurityError>",effect {security},docs/spec/3-5-core-io-path.md#42-セキュリティヘルパ,compiler/runtime/src/path/security.rs,In Progress (Rust runtime),SecurityPolicy と `PathSecurityError` を実装し、`docs/spec/3-6-core-diagnostics-audit.md` の `core.path.security.invalid/violation` を `tests/path_security.rs` + `tests/data/core_path/security/*.json` で検証。Capability `security.fs.policy` と `EffectLabels.security` を診断へ転写。
Core.Path.Security,sandbox_path,"fn sandbox_path(path: Path, root: Path) -> Result<Path, SecurityError>",effect {security},docs/spec/3-5-core-io-path.md#42-セキュリティヘルパ,compiler/runtime/src/path/security.rs,In Progress (Rust runtime),Sandbox ルート強制と正規化済み比較を実装し、`core.path.security.violation` / `metadata.security.sandbox_root` を JSON ゴールデンで確認。`FsAdapter::ensure_security_policy()` を利用した Capability チェックも追加。
Core.Path.Security,is_safe_symlink,"fn is_safe_symlink(path: Path) -> Result<Bool, IoError>","effect {io, io.blocking, security}",docs/spec/3-5-core-io-path.md#42-セキュリティヘルパ,compiler/runtime/src/path/security.rs,In Progress (Rust runtime),`fs::symlink_metadata`/`read_link` ベースの検証を追加し、絶対ターゲット・`..` 含むケースで `core.path.security.symlink` を返却。`#[cfg(unix)]` のテストで `tests/data/core_path/security/symlink_absolute.json` を参照。
Core.Path.Strings,PathStyle,enum PathStyle = Native | Posix | Windows,@pure,docs/spec/3-5-core-io-path.md#43-文字列ユーティリティクロスプラットフォーム,compiler/runtime/src/path/string_utils.rs,Implemented (Rust runtime),`compiler/runtime/src/path/mod.rs` に `PathStyle` を追加し、`string_utils.rs` から再公開。`tests/path_string_utils.rs` と `tests/data/core_path/unicode_cases.json` で Native/Posix/Windows を検証。
Core.Path.Strings,normalize_path,"fn normalize_path(text: Str, style: PathStyle = Native) -> Result<Str, PathError>",@pure,docs/spec/3-5-core-io-path.md#43-文字列ユーティリティクロスプラットフォーム,compiler/runtime/src/path/string_utils.rs,Implemented (Rust runtime),`normalize_path_str` が POSIX/Windows/UNC を純粋に正規化し `record_text_mem_copy` を通じて効果記録。`reports/spec-audit/ch3/path_unicode-20251130.md` に `cargo test ... path_string_utils` の期待値を保存。
Core.Path.Strings,join_paths,"fn join_paths(parts: List<Str>, style: PathStyle = Native) -> Result<Str, PathError>",@pure,docs/spec/3-5-core-io-path.md#43-文字列ユーティリティクロスプラットフォーム,compiler/runtime/src/path/string_utils.rs,Implemented (Rust runtime),`join_paths_str` が絶対パス出現時に経路をリセットし、`tests/path_string_utils.rs` の `unicode_cases.join` セクションで POSIX/Windows/UNC ケースをゴールデン化。
Core.Path.Strings,is_absolute_str,"fn is_absolute_str(text: Str, style: PathStyle = Native) -> Bool",@pure,docs/spec/3-5-core-io-path.md#43-文字列ユーティリティクロスプラットフォーム,compiler/runtime/src/path/string_utils.rs,Implemented (Rust runtime),`is_absolute_str` がドライブ/UNC/ルート相対を認識し、`relative_to` を含むテスト (`tests/path_string_utils.rs`) で利用。`docs/plans/bootstrap-roadmap/README.md` Phase3 ハイライトに Text ↔ Path 連携を追記。
Core.Path.Watcher,WatchEvent,type WatchEvent = Created(Path) | Modified(Path) | Deleted(Path),"effect {io, io.async}",docs/spec/3-5-core-io-path.md#44-ファイル監視オプション,compiler/runtime/src/io/watcher.rs,Implemented (Rust runtime),`WatchEvent` を Rust Runtime で提供し、`notify` の `EventKind` から `Created/Modified/Deleted` へ射影。`tests/watcher.rs` で `WatchEvent` 種別を受信し、`fixtures/watcher/simple_case` をコピーして検証。
Core.Path.Watcher,watch,"fn watch(paths: List<Path>, callback: (WatchEvent) -> ()) -> Result<Watcher, IoError>","effect {io, io.async}",docs/spec/3-5-core-io-path.md#44-ファイル監視オプション,compiler/runtime/src/io/watcher.rs,Implemented (Rust runtime),`watch` が `notify`/`fs.watcher.*` Capability を検証し、`effect {io.async}` と `IoError::into_diagnostic()` に `metadata.io.watch.*` を転写。`tests/watcher.rs::watch_reports_create_and_delete_events` が tempdir で `Core.Path.Watcher` API を通し、`close_watcher` でリソースを解放。
Core.Path.Watcher,watch_with_limits,"fn watch_with_limits(paths: List<Path>, limits: WatchLimits, callback: (WatchEvent) -> ()) -> Result<Watcher, IoError>","effect {io, io.async}",docs/spec/3-5-core-io-path.md#44-ファイル監視オプション,compiler/runtime/src/io/watcher.rs,Implemented (Rust runtime),`WatchLimits` の `max_events_per_second`/`max_depth`/`exclude_patterns` を `globset` ベースで検証し、`fs.watcher.recursive` Capability を条件付きで要求。`watch_with_limits_rejects_invalid_path` テストが無効パスで `IoErrorKind::InvalidInput`/`metadata.io.watch.*` を確認。
Core.Path.Watcher,close,"fn close(watcher: Watcher) -> Result<(), IoError>",effect {io},docs/spec/3-5-core-io-path.md#44-ファイル監視オプション,compiler/runtime/src/io/watcher.rs,Implemented (Rust runtime),`Watcher`/`WatcherHandle` が Drop/`close_watcher` 経由で `WatcherCommand::Shutdown` を送信し、JoinHandle を `ScopeGuard` 相当で回収。`IoError` は `watch.queue_size`/`watch.delay_ns` を `metadata.io.watch.*` と `AuditEnvelope` に記録する。
