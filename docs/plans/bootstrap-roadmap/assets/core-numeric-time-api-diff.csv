module,api,signature,effects,spec_ref,rust_impl_path,impl_status,notes
Core.Numeric,Numeric,"trait Numeric<T> { zero() -> T; one() -> T; abs(T) -> T; clamp(T, T, T) -> T }","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"`core_numeric` feature 配下にトレイト定義と整数/浮動実装を追加。型推論連携テストは `docs/plans/rust-migration/1-1-ast-and-ir-alignment.md` に追記し、`compiler/frontend/tests/type_numeric.rs` 追加計画へリンク。"
Core.Numeric,OrderedFloat,"trait OrderedFloat<T> { is_nan(T) -> Bool; is_infinite(T) -> Bool; total_cmp(T, T) -> Ordering }","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"`f32`/`f64` で `total_cmp` ラッパを実装済み。今後 Decimal 等へ拡張する際の TODO は `core-numeric-time-gap-log.md` へ登録。"
Core.Numeric,lerp,"fn lerp<T: Numeric + Copy>(start: T, end: T, t: Float) -> T","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"`Floating` 制約を導入し `IterNumericExt` と併用できるようにした。今後 `Decimal`/`Ratio` へ拡張する際はテストケースを `numeric_basic` スイートへ追加する。"
Core.Numeric,mean,"fn mean<T: Numeric>(iter: Iter<T>) -> Option<T>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"`Iter.try_fold` + Welford 法で実装し、`core_numeric` feature の単体テスト (`mean/variance`) を追加。整数入力や `effect {mem}` 計測は今後の拡張対象。"
Core.Numeric,variance,"fn variance<T: Numeric>(iter: Iter<T>) -> Option<T>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"母分散を返す PoC を追加。分散の分母（標本/母選択）や診断連携の要件は別タスクで追跡。"
Core.Numeric,percentile,"fn percentile(iter: Iter<Float>, p: Float) -> Option<Float>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"Nearest-rank + 線形補間を `Iter` 基盤で実装。`List`/`Map` 連携や `effect {mem}` 計測は後続ロット。"
Core.Numeric,median,"fn median<T: Numeric + Ord>(iter: Iter<T>) -> Option<T>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"`Iter::collect<Vec<T>>` ベースで lower median を返す PoC を追加。`reports/spec-audit/ch3/numeric_basic-extended.md` でケースを固定し、`IterNumericExt::median` 経由で利用可能。"
Core.Numeric,mode,"fn mode<T: Numeric + Eq + Hash>(iter: Iter<T>) -> Option<T>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"ハッシュマップで頻度と `first_seen` を管理し、最初に現れた最頻値を返す実装を追加。`IterNumericExt::mode` と単体テストを整備。"
Core.Numeric,range,"fn range<T: Numeric + Ord>(iter: Iter<T>) -> Option<(T, T)>","@pure",docs/spec/3-4-core-numeric-time.md#1-数値プリミティブとユーティリティ,compiler/runtime/src/numeric/mod.rs,PoC,"最初の要素を基準に逐次比較する `range` を実装。`IterNumericExt::range` から呼び出し、`iter_numeric` テストで最小/最大ペアを検証。"
Core.Numeric.Statistics,HistogramBucketState,"type HistogramBucketState = { bucket: HistogramBucket, count: u64, sum: Option<Float> }","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/histogram.rs,PoC,"`HistogramBucketState`/`HistogramBucket` を `core_numeric` feature 配下に追加。`sum` は `Option<f64>` で記録し、`List::from_vec` と互換。"
Core.Numeric.Statistics,histogram,"fn histogram(Iter<Float>, List<HistogramBucket>) -> Result<List<HistogramBucketState>, Diagnostic>","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/histogram.rs,PoC,"`StatisticsError` を `IntoDiagnostic` で昇格させる PoC を追加。`tests/data/numeric/histogram/*.json` と `scripts/validate-diagnostic-json.sh --pattern numeric.histogram` で JSON 契約を検証。"
Core.Numeric.Statistics,rolling_average,"fn rolling_average(window: usize, values: Iter<Float>) -> Iter<Float>","@pure (内部で effect {mem})",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/iter.rs,PoC,"VecDeque ベースの遅延計算を実装し、`numeric/effects.rs` と `Iter::scan` を組み合わせて `effect {mem}` を記録。`NumericCollector` により Stage/監査情報を取得可能。"
Core.Numeric.Statistics,z_score,"fn z_score(value: Float, mean: Float, stddev: Float) -> Option<Float>","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/iter.rs,PoC,"非有限値/0 除算を弾いた Z スコアを実装。`iter_numeric_props.rs` で QuickCheck により基礎精度を固定。"
Core.Numeric.Statistics,quantiles,"fn quantiles(Iter<Float>, List<Float>) -> Result<Map<Float, Float>, StatisticsError>","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/statistics.rs,PoC,"`statistics.rs` を新設し、`OrderedFloat` キーで `Map` を構築。ThreadLocal `take_numeric_effects_snapshot()` により `effect {mem}` / `numeric.quantiles.mem_bytes` KPI を測定し、`tests/expected/numeric_quantiles.json` で CI 入力を共有。"
Core.Numeric.Statistics,correlation,"fn correlation(Iter<Float>, Iter<Float>) -> Result<Float, StatisticsError>","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/statistics.rs,PoC,"ピアソン係数を 1 パスで算出し、長さ不一致・非有限値は `StatisticsError` へ昇格。`tooling/ci/collect-iterator-audit-metrics.py --section numeric_time --scenario statistics_accuracy` で監視予定。"
Core.Numeric.Statistics,linear_regression,"fn linear_regression(Iter<(Float, Float)>) -> Result<LinearModel, StatisticsError>","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/statistics.rs,PoC,"`LinearModel { slope, intercept, r_squared }` を実装し、`Iter` から 1 パスで最小二乗解を導出。`tests/expected/numeric_regression.json` と単体テストで精度を固定。"
Core.Numeric.Statistics,StatisticsError,"type StatisticsError = { kind: StatisticsErrorKind, message: Str }","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/error.rs,PoC,"`StatisticsError`/`StatisticsErrorKind` を `IntoDiagnostic` 実装付きで追加し、`StatisticsTags`/`with_tags` で `numeric.statistics.*` / `data.stats.*` メタデータ（`column`/`aggregation`/`audit_id`）を一括付与。`encode_sample_value` で `NaN`/`±Infinity` を JSON 文字列化し、`scripts/validate-diagnostic-json.sh --suite numeric` で `tests/data/numeric/decimal_cases.json` などを検証。"
Core.Numeric.Statistics,StatisticsErrorKind,"enum StatisticsErrorKind = InsufficientData | InvalidParameter | NumericalInstability","@pure",docs/spec/3-4-core-numeric-time.md#2-統計・データ品質サポート,compiler/runtime/src/numeric/error.rs,PoC,"Kind ごとのコード (`core.numeric.statistics.*`) を定義し、`histogram` から `H-0x` ルールで利用。"
Core.Time,Timestamp,"type Timestamp = { seconds: i64, nanos: i32 }","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"UNIX エポック基準の構造体と `serde` 変換を実装。`tests/data/time/timezone_cases.json` と `cargo test --features core_time` で正規化を検証。"
Core.Time,Duration,"type Duration = { seconds: i64, nanos: i32 }","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"`from_total_nanoseconds` を追加し、Timestamp/Timezone 双方から安全に利用できるようにした。"
Core.Time,now,"fn now() -> Result<Timestamp, TimeError>","effect {time}",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"`SystemClockAdapter` から OS クロックを呼び出し `effect {time}` / syscall レイテンシを記録。"
Core.Time,monotonic_now,"fn monotonic_now() -> Result<Timestamp, TimeError>","effect {time}",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"`Instant` ベースの差分を Timestamp へ加算し、`take_time_syscall_metrics()` で観測できるようにした。"
Core.Time,duration_between,"fn duration_between(start: Timestamp, end: Timestamp) -> Duration","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"正規化済み Timestamp 差分を `Duration` として返却。単体テスト `duration_between_matches_manual_diff` で固定。"
Core.Time,add_duration,"fn add_duration(ts: Timestamp, delta: Duration) -> Timestamp","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"オーバーフロー検出付きの加算を実装し、`checked_add_duration` で `TimeError` を返す経路を提供。"
Core.Time,sleep,"fn sleep(duration: Duration) -> Result<(), TimeError>","effect {time}",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/mod.rs,PoC,"`thread::sleep` をラップし `effect {time}` / syscall 遅延を `TimeSyscallMetrics` へ記録。"
Core.Time,TimeError,"type TimeError = { kind: TimeErrorKind, message: Str, timestamp: Option<Timestamp> }","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/error.rs,In Progress,"`IntoDiagnostic` 実装を追加し、`time.platform`/`time.timezone`/Capability Stage を診断・監査メタデータへ書き込むようにした。"
Core.Time,TimeErrorKind,"enum TimeErrorKind = SystemClockUnavailable | InvalidTimezone | TimeOverflow","@pure",docs/spec/3-4-core-numeric-time.md#3-時間・期間型,compiler/runtime/src/time/error.rs,PoC,"コード `core.time.*` を割り当て、`TimeErrorKind::as_str` でメタデータキー整合を管理。"
Core.Time.Format,TimeFormat,"enum TimeFormat = Rfc3339 | Unix | Custom(Str)","@pure",docs/spec/3-4-core-numeric-time.md#31-時刻フォーマット,compiler/runtime/src/time/mod.rs,In Progress,"`serde(tag=\"kind\")` 付き列挙を追加し、フォーマット/パース実装 (Plan §4.3) 着手前に API を固定。"
Core.Time.Format,format,"fn format(ts: Timestamp, fmt: TimeFormat) -> Result<String, Diagnostic>","effect {unicode}",docs/spec/3-4-core-numeric-time.md#31-時刻フォーマット,compiler/runtime/src/time/format.rs (未作成),Missing,"ICU 互換の文字列化と `Core.Text` 連携が未実装。"
Core.Time.Format,parse,"fn parse(str: Str, fmt: TimeFormat) -> Result<Timestamp, Diagnostic>","effect {unicode}",docs/spec/3-4-core-numeric-time.md#31-時刻フォーマット,compiler/runtime/src/time/format.rs (未作成),Missing,"フォーマッタ逆変換とエラー処理が存在しない。"
Core.Time.Timezone,Timezone,"type Timezone = { name: Str, offset: Duration }","@pure",docs/spec/3-4-core-numeric-time.md#32-タイムゾーンサポート,compiler/runtime/src/time/timezone.rs,PoC,"固定 UTC±HH:MM を扱う `Timezone` 構造体を追加し、`serde` 序列化と Capability Stage 検証を組み込んだ。"
Core.Time.Timezone,utc,"fn utc() -> Timezone","@pure",docs/spec/3-4-core-numeric-time.md#32-タイムゾーンサポート,compiler/runtime/src/time/timezone.rs,PoC,"UTC 定数を返し、`collect_numeric_time_metrics` の基準ケースとして `tests/data/time/timezone_cases.json` に登録。"
Core.Time.Timezone,local,"fn local() -> Result<Timezone, TimeError>","effect {time}",docs/spec/3-4-core-numeric-time.md#32-タイムゾーンサポート,compiler/runtime/src/time/timezone.rs,PoC,"`time::OffsetDateTime::now_local()` でローカル offset を取得し、Capability `core.time.timezone.local` を検証。"
Core.Time.Timezone,timezone,"fn timezone(name: Str) -> Result<Timezone, TimeError>","effect {time}",docs/spec/3-4-core-numeric-time.md#32-タイムゾーンサポート,compiler/runtime/src/time/timezone.rs,PoC,"`UTC±HH[:MM]`/`Z`/`Etc/UTC` 形式を解析し、`TimeError::invalid_timezone` に `time.timezone` メタデータを残す。"
Core.Time.Timezone,convert_timezone,"fn convert_timezone(ts: Timestamp, from: Timezone, to: Timezone) -> Result<Timestamp, TimeError>","@pure",docs/spec/3-4-core-numeric-time.md#32-タイムゾーンサポート,compiler/runtime/src/time/timezone.rs,PoC,"`Duration::from_total_nanoseconds` を利用して offset 差分を加算。`tests/data/time/timezone_cases.json` の `convert_cases` で検証。"
Core.Diagnostics.Metrics,MetricPoint,"type MetricPoint<T> = { name: Str, value: T, timestamp: Timestamp, tags: Map<Str, Str> }","@pure",docs/spec/3-4-core-numeric-time.md#4-メトリクスと監査連携,compiler/runtime/src/diagnostics/metric_point.rs,PoC,"`MetricPoint`/`MetricValue` を追加し、`metric_point.tags`/`metric_point.timestamp.*` を JSON へ出力。`tests/data/metrics/metric_point_cases.json`/`reports/spec-audit/ch3/metric_point-emit_metric.json` で確認。"
Core.Diagnostics.Metrics,IntoMetricValue,"trait IntoMetricValue for Float/Int/Duration/Timestamp","@pure",docs/spec/3-4-core-numeric-time.md#4-メトリクスと監査連携,compiler/runtime/src/diagnostics/metric_point.rs,PoC,"`Float`/`Int`/`Duration`/`Timestamp` の `IntoMetricValue` を実装し、`metric_point.kind` と `metric_point.value` を Audit メタデータへ記録。"
Core.Diagnostics.Metrics,metric_point,"fn metric_point<T: IntoMetricValue>(name: Str, value: T) -> MetricPoint<T>","@pure",docs/spec/3-4-core-numeric-time.md#4-メトリクスと監査連携,compiler/runtime/src/diagnostics/metric_point.rs,PoC,"`metric_point()` ヘルパを実装し、`Timestamp::unix_epoch()` fallback とタグ付けチェーン API を提供。"
Core.Diagnostics.Metrics,attach_audit,"fn attach_audit(mp: MetricPoint<T>, audit_id: Option<Uuid>) -> MetricPoint<T>","@pure",docs/spec/3-4-core-numeric-time.md#4-メトリクスと監査連携,compiler/runtime/src/diagnostics/metric_point.rs,PoC,"`attach_audit` で `metric_point.audit_id` を設定し `metric_point.audit_id`/`metric_point.tag.*` を監査メタデータへ出力。"
Core.Diagnostics.Metrics,emit_metric,"fn emit_metric(MetricPoint<Float>, AuditSink) -> Result<(), Diagnostic>","effect {audit}",docs/spec/3-4-core-numeric-time.md#4-メトリクスと監査連携,compiler/runtime/src/diagnostics/metric_point.rs,PoC,"`MetricAuditSink` トレイトを導入し `emit_metric` で `MetricAuditRecord.metadata`（`effect.capability = metrics.emit` 等）を構築。`collect-iterator-audit-metrics.py --scenario emit_metric` 連携済み。"
Core.Numeric.Precision,Precision,"enum Precision = Float32 | Float64 | Decimal { scale, precision } | Arbitrary","@pure",docs/spec/3-4-core-numeric-time.md#6-数値精度と丸め設定,compiler/runtime/src/numeric/precision.rs,PoC,"`Precision` 列挙体を追加し、`decimal` feature 有効時は `Decimal` 精度、無効時は `NumericError::unsupported_precision` を返す。"
Core.Numeric.Precision,with_precision,"fn with_precision<T>(value: T, precision: Precision) -> Result<T, NumericError>","@pure",docs/spec/3-4-core-numeric-time.md#6-数値精度と丸め設定,compiler/runtime/src/numeric/precision.rs,PoC,"`PrecisionValue` トレイトで `f32`/`f64`/`Decimal`/整数の経路を実装し、`NumericError` で `numeric.precision.*` メタデータを出力。"
Core.Numeric.Precision,round_to,"fn round_to<T: Numeric>(value: T, places: u8) -> T","@pure",docs/spec/3-4-core-numeric-time.md#6-数値精度と丸め設定,compiler/runtime/src/numeric/precision.rs,PoC,"浮動小数点は `round_float`、`Decimal` は `round_dp_with_strategy` で丸め、`tests::numeric::precision::round_and_truncate_f64_values` で検証。"
Core.Numeric.Precision,truncate_to,"fn truncate_to<T: Numeric>(value: T, places: u8) -> T","@pure",docs/spec/3-4-core-numeric-time.md#6-数値精度と丸め設定,compiler/runtime/src/numeric/precision.rs,PoC,"切り捨て処理と `tests/data/numeric/precision/*.json` の診断サンプルで CLI/LSP スキーマ整合を確認。"
Core.Numeric.Precision,currency_add,"fn currency_add(Decimal, Decimal, CurrencyCode) -> Result<Decimal, NumericError>","@pure",docs/spec/3-4-core-numeric-time.md#62-金融計算向け最適化,compiler/runtime/src/numeric/finance.rs,PoC,"`CurrencyCode` 型と `currency_add` を追加し、USD/EUR/JPY/GBP の `scale` に応じて `MidpointNearestEven` で丸める。未知のコードは `NumericErrorKind::UnsupportedCurrency` を返し、`tests/data/numeric/finance/unsupported_currency.json` でスキーマ検証。"
Core.Numeric.Precision,compound_interest,"fn compound_interest(Decimal, Float, u32) -> Result<Decimal, NumericError>","@pure",docs/spec/3-4-core-numeric-time.md#62-金融計算向け最適化,compiler/runtime/src/numeric/finance.rs,PoC,"`Decimal` による複利演算（`(1 + rate)^n`）を実装し、`numeric::tests::compound_interest_and_npv_return_expected_values` で検証。`rate` 変換失敗時は `NumericError::conversion_failed` を返す。"
Core.Numeric.Precision,net_present_value,"fn net_present_value(Iter<Decimal>, Float) -> Result<Decimal, NumericError>","@pure",docs/spec/3-4-core-numeric-time.md#62-金融計算向け最適化,compiler/runtime/src/numeric/finance.rs,PoC,"`Iter<Decimal>` を割引現在価値へ畳み込み、`rate` から算出した discount factor を順次乗算する設計。`numeric::tests::compound_interest_and_npv_return_expected_values` にサンプルを追加し、`scripts/validate-diagnostic-json.sh --suite numeric` で finance JSON を検証。"
