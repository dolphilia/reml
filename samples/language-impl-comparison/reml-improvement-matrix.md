# Reml 改善注目マトリクス

この資料は `samples/language-impl-comparison/` に含まれる既存サンプルの観点から、Reml 仕様で重点的に補強すべき領域を整理したものです。比較対象言語や実装予定リストを踏まえ、仕様書の該当章を参照しながら改善タスクの優先度付けに利用できます。

| 観点 | 参考実装/根拠 | Reml 現状から読み取れるポイント | 仕様改善に向けた着眼点 | 関連章 | 進行状況 |
| - | - | - | - | - | - |
| 字句解析とトークナイズ | `samples/language-impl-comparison/reml/json_parser.reml:56` | 手続き型トークナイザーが `Text.char_at` と `List.push_back` を逐一呼び出し、`read_*` 系は TODO なダミー実装のまま。 | `Core.Parse.Lex` を既定値として組み込む手順と、Unicode 正規化/数値解析のエラーを `Diagnostic` に変換するガイドラインを 2-3/3-3 へ追記する。 | 1-1, 2-3, 3-3, 3-5 | 未着手 |
| パーサーコンビネーター運用 | `samples/language-impl-comparison/reml/json_extended.reml:27`, `samples/language-impl-comparison/reml/yaml_parser.reml:120` | コメントスキップやトレーリングカンマ、インデント検証など高度な前処理を `RunConfig` 設定なしに都度書いている。 | `RunConfig` の Packrat/左再帰/コメント扱いを公式スイッチとして整理し、ストリーミング・復旧戦略を Chapter 2 と `guides/core-parse-streaming.md` で体系化する。 | 2-0, 2-2, 2-6, guides/core-parse-streaming.md | 未着手 |
| 効果ハンドリング戦略 | `samples/language-impl-comparison/reml/algebraic_effects.reml:32` | 1-3 §I.5 で効果行整列とハンドラ順序、3-6 §2.4 で診断・監査フロー、3-8 §1.2 で Stage/Capability 検査、notes §5 で比較マトリクスを提示。 | LSP 診断・CLI 連携の実装フォロー（`effects.contract.*` 系）と Stage 運用を監査ログへ拡張。 | 1-3, 3-6, 3-8, notes/dsl-plugin-roadmap.md | 完了（仕様更新済み） |
| 診断とエラー報告 | `samples/language-impl-comparison/reml/yaml_parser.reml:58`, `samples/language-impl-comparison/reml/yaml_parser.reml:139` | インデント不一致やネスト判定で `Parse.fail` に素朴な文字列を渡しており、スパン・期待集合・監査メタが欠落。 | 2-5 §B-11 で `Parse.fail`/`Parse.recover` の診断生成フローを明文化し、3-6 §2.2 で `from_parse_error` とエラーコードカタログ、3-7 §3.2 で Config 監査連携を定義。 | 2-5, 3-6, 3-7 | 完了（仕様更新済み） |
| 標準コレクション操作 | `samples/language-impl-comparison/reml/yaml_parser.reml:156`, `samples/language-impl-comparison/reml/template_engine.reml:343` | 3-1/3-2 で `List`/`Map` の順序保証・構造共有契約・`Iter` 連携を明文化し、`guides/collection-pipeline-guide.md` で実装レシピも整理済み。 | DSL 作者向けのサンプル拡充は引き続き `guides/dsl-gallery.md` 側で検討する。 | 3-1, 3-2, guides/collection-pipeline-guide.md | 完了（仕様・ガイド更新済み） |
| Unicode/Grapheme 操作 | `samples/language-impl-comparison/reml/markdown_parser.reml:40`, `samples/language-impl-comparison/reml/markdown_parser.reml:48` | 1-4 §G.1 と 2-5 §B-11 で `ParseState`→`Diagnostic` の列共有規約を制定し、3-3 §5.1 で `display_width` を用いた幅計算手順を標準化。`markdown_parser.reml` も `display_width` による列更新へ移行済み。 | IDE/LSP 実装でのフォローアップ（`GraphemeSeq::width` を活用した抜粋表示検証）をガイドへ拡張する余地あり。 | 1-4, 2-5, 3-3 | 完了（1-4/2-5/3-3 更新済み） |
| 設定ファイル拡張耐性 | `samples/language-impl-comparison/reml/json_extended.reml:27`, `samples/language-impl-comparison/reml/json_extended.reml:74` | コメント許容・トレーリングカンマ・期待集合活用が手動実装で、互換性スイッチや診断メタは未統一。 | 2-3 §G-1 に `ConfigTriviaProfile`、3-7 §1.5 に `ConfigCompatibility`、3-10 §2.1 に `REML_CONFIG_*` 連携を追加し、互換モードと監査ポリシーを共有可能にした。 | 2-3, 3-7, 3-10 | 完了（仕様更新済み） |
| テンプレート DSL とセキュリティ | `samples/language-impl-comparison/reml/template_engine.reml:64`, `samples/language-impl-comparison/reml/template_engine.reml:242`, `samples/language-impl-comparison/reml/template_engine.reml:329` | フィルター登録・HTML エスケープ・`Map` ベースの実行環境が独自実装で、効果タグや Capability 要件が未整理。 | `Core.Text.Template` のセグメント/フィルター API、`TemplateCapability` プリセット、`DiagnosticDomain::Template` と監査フローを整備。1-1 で DSL 指針を追加し、3-3/3-6/3-8 に実行・診断・権限仕様を追記。 | 1-1, 3-3, 3-6, 3-8 | 完了（仕様更新済み） |
| Regex/Parser 連携と性能 | `samples/language-impl-comparison/reml/regex_engine.reml:10`, `samples/language-impl-comparison/reml/regex_engine.reml:175` | 2-2 §H で `Core.Parse.Regex` の派生コンビネータ、2-6 §F で `RegexRunConfig` と `memo=auto` 指針、3-3 §10 で Unicode プロファイル、3-8 §1.4 で `RuntimeCapability::RegexJit/RegexMetrics` を定義済み。 | サンプル側で `RegexRunConfig` の実装例とメトリクス活用手順を補足し、`guides/runtime-bridges.md` に Regex capability の統合事例を追記する。 | 2-2, 2-6, 3-3, 3-8 | 完了（仕様更新済み） |
| 並行・分散モデル比較 | `samples/language-impl-comparison/README.md:12` | Elixir・Scala 3・Nim など並行モデルを持つ比較対象が列挙される一方、Reml の並行 API サンプルは未整備。 | `Core.Async`・`Core.FFI` の仕様ドラフトを進め、Actor/プロセス指向 DSL の最小例と Capability 検証手順を公開する。 | 3-9, guides/runtime-bridges.md, 3-8 | 未着手 |

> 今後、比較サンプルが追加された際は、本マトリクスの「参考実装/根拠」列を更新し、`README.md` の新項目と整合させてください。
