# Reml オブジェクト指向支援 API 調査メモ

## 1. 調査背景と目的
- Reml はパーサーコンビネーターに最適化された言語であり、DSL やコンパイラを迅速に構築することを主眼としている。
- 標準 API に「オブジェクト指向」機能を組み込むことで、利用者が Reml 上で OOP 的特徴を持つ言語を短期間で設計できるかを評価する。
- 本調査では Reml の設計哲学・型システム・既存シナリオを確認し、OOP 支援 API の妥当性を検討するための観点を整理する。

## 2. Reml 設計の前提
- **実用性最優先**: 実運用レベルの性能・FFI・LLVM/JIT 連携を確保することが最上位ゴール（`0-1-overview.md`, `0-2-project-purpose.md`）。
- **小さく強いコア**: 言語機能も Core.Parse も 12〜15 の本質的プリミティブへ還元し、合成で拡張する思想を徹底。
- **宣言で終わらせる操作性**: 演算子優先度・空白・字句規則などを宣言 DSL として提供し、利用者が意図を短く表現できるようにする。
- **高品質な診断・ツール連携**: SpanTrace、期待集合、RunConfig などの診断情報を保持し IDE/LSP 連携を重視する。
- **Unicode ファースト**: `byte/char/grapheme` の 3 層モデルを前提にした入力処理が標準で求められる。

## 3. 型システムと標準 API の制約
- **Hindley–Milner 型推論**を採用し、トレイト（型クラス風）で静的オーバーロードを扱う。サブタイピングやクラス継承は標準では想定していない。
- Core.Parse は `consumed`/`committed` ビット、Packrat メモ化、SpanTrace などによって高品質なエラーと性能を両立しており、追加 API も同水準の診断を提供する必要がある。
- Core.Config や Core.Data など既存モジュールは宣言的 DSL と型安全性を両立しており、新たな OOP 支援もこの一貫性を維持することが求められる。

## 4. オブジェクト指向支援 API 検討観点
1. **コア哲学との整合性**
   - 小さく強いプリミティブを崩さず、合成可能な最小 API 群として設計できるか。
2. **宣言的表現の確保**
   - クラス/メソッドに相当する構造を宣言 DSL やビルダーで定義でき、利用者が意図を簡潔に書けること。
3. **型システムとの適合**
   - サブタイピングに頼らない多相オブジェクト、型クラス的ディスパッチ、ADT を活用した合成など HM と矛盾しないモデルが必要。
4. **診断品質・ツール連携**
   - SpanTrace や期待集合と連携したエラーメッセージ、IDE 補完・リファクタリング支援用メタデータを提供可能か。
5. **性能と実運用性**
   - Packrat/左再帰制御、JIT/FFI との橋渡しを阻害しない抽象化レイヤであること。
6. **シナリオ適合性**
   - ゲームエンジン向け DSL やエンタープライズツールなど、実シナリオで OOP 支援が効果的かどうかを評価する指標を持つ。

## 5. 想定シナリオとの接点
- **ゲームエンジン向けスクリプト**: 役割やコンポーネント単位の API を OOP スタイルで宣言できれば、エンジン統合やホットリロード運用に有利。
- **エンタープライズ DSL / Web フレームワーク**: ドメインモデルの階層構造や責務分離を表現する際に、OOP 的抽象化が開発体験を向上させる可能性がある。
- **IDE/ツール統合**: オブジェクト構造情報を LSP へ公開できれば、補完やナビゲーション品質の向上が期待できる。

## 6. 今後の調査計画
1. オブジェクト指向パラダイム（継承ベース、プロトタイプ、トレイト/ミックスイン、データ指向 OOP など）の文献を収集し、Reml の要件との適合性を一次評価する。
2. HM 型推論と相性が良い抽象化（型クラス、辞書渡し、ADT 組合せなど）を整理し、必要な API インターフェイスを草案化する。
3. Core.Parse / Core.Data / ParserPlugin との連携要件を列挙し、診断メタデータや宣言 DSL の拡張方針を検討する。
4. 想定シナリオごとに OOP 支援がもたらす効果と代替手段を比較し、導入判断の評価指標を策定する。

---

本メモは OOP 支援 API の妥当性調査に向けた出発点であり、次段階では各パラダイムの研究・実装事例を収集して詳細な比較検討を行う。
