# Reml パラダイム支援検討メモ

## 1. 調査目的
- Reml の標準 API にオブジェクト指向以外の主要パラダイム支援を組み込む必要があるかを確認する。
- Reml の設計哲学・既存仕様（Core.Parse, Core.Config, Core.Data 等）と調和する支援方針を検討する。
- 想定シナリオや既存の横断テーマと照合し、優先度付けと今後のアクションを整理する。

## 2. Reml の設計上の前提
- **実用性最優先**と**小さく強いコア**の設計方針（`0-1-overview.md`, `0-2-project-purpose.md`）。
- 宣言 DSL による操作性、高品質診断、Unicode 前提がコア要求。
- HM 型推論 + トレイト、効果フラグ（`mut`, `io`, `ffi`, など）による安全性制御（`1-2-types-Inference.md`, `1-3-effects-safety.md`）。
- Core.Parse のストリーム実行や Packrat メモ化、Core.Data のスキーマ管理等、既存APIが多様なDSLに対応する基盤を提供。

## 3. 検討したパラダイム
- 関数型／宣言型DSL
- データモデリング／データ駆動
- データフロー／ストリーミング
- 並行／Actor／async
- リアクティブ／イベント駆動
- 制約／ポリシー（ロジック）
- 確率的／機械学習
- メタプログラミング／DSLプラグイン

## 4. 支援導入の妥当性評価

### 4.1 高優先で検討すべき領域
- **データフロー／ストリーミング**
  - 背景: `run_stream`, `Continuation` によるストリーム基盤が既に存在。
  - 支援方針: バックプレッシャ制御や差分適用ヘルパを標準APIとして追加、エラーメタデータとの連携を強化。
- **並行／Actor／async**
  - 背景: 効果システムで今後の導入を想定（`1-3-effects-safety.md`）。
  - 支援方針: 効果フラグ拡張（`io`サブ分類等）と属性検査、メッセージパッシングDSLの検討を段階的に進める。
- **リアクティブ／イベント駆動**
  - 背景: ワークフローやIDE拡張シナリオで需要が高い（`scenario-requirements.md`）。
  - 支援方針: ストリームAPIを活用したイベントDSLヘルパ、タイムベース処理の抽象化を検討。
- **データモデリング／データ駆動**
  - 背景: `Core.Data` の機能が実務シナリオで中心となる。
  - 支援方針: データ品質DSL、統計型拡張、スキーマ検証ツール統合をロードマップへ継続追加。

### 4.2 既存機能の強化で足りる領域
- **関数型／宣言型DSL**
  - Reml自体が宣言的DSL構築を支援するため、トレイト・パイプ機能の整備、ベストプラクティス文書化で十分。
- **制約／ポリシー（ロジック）**
  - Core.Config/Core.Data の検証DSL、属性検査を活用し、標準APIへの大規模拡張は不要。必要ならプラグインで対応。
- **メタプログラミング／DSLプラグイン**
  - `ParserPlugin` と `CapabilitySet` で十分な拡張ポイントがある。ガイドとテンプレートの整備を優先。

### 4.3 標準APIへの組込み優先度が低い領域
- **確率的／機械学習**
  - Tensor型や自動微分は高コスト。現状は FFI とデータAPIでの連携に留め、専用支援は外部モジュール案とする。
- **ロジック言語フルサポート**
  - HM 型推論との整合が難しくユースケースも限定的。外部DSLテンプレートで対応する。

## 5. 推奨アクション
1. **ストリーム／リアクティブ拡張案の具体化**
   - `run_stream` 基盤上の共通ヘルパを設計し、バックプレッシャや継続処理のエラーメタデータ拡張を整理。
2. **並行支援の効果統合ガイドの作成**
   - 効果フラグ拡張、属性検査、`async` 導入時のAPI設計方針を検証メモとしてまとめる。
3. **データモデリングAPI拡充ロードマップ**
   - データ品質DSLや統計型の追加、Core.Config との統合ポイントを整理し、標準化すべきAPI候補を提示。
4. **制約DSL・ポリシー検証の利用ガイド強化**
   - Core.Config/Core.Data を用いた制約記述と検証フローのベストプラクティスを文書化。標準APIに組み込む機能とプラグインで提供する機能の線引きを明確にする。

## 6. 詳細検討成果
### 6.1 ストリーム／リアクティブ拡張
- `reml-stream-reactive-extension.md` を作成し、`StreamDriver`/`FlowController`/`StreamDiagnosticHook` といった共通ヘルパ案、`DemandHint` を含むバックプレッシャ契約、`ContinuationMeta` 拡張によるエラーメタデータの整理を実施。
- `2-6-execution-strategy.md`・`2-5-error.md`・`guides/lsp-integration.md` への追補ポイントと、ホットリロード/IDE シナリオへの適用手順を明文化。

### 6.2 並行支援と効果統合
- `reml-async-io-investigation.md` の第8節として効果フラグ細分化（`io.async`/`io.blocking`/`io.timer`）、属性検査（`@async_free`/`@no_blocking`/`@scheduler`/`@must_await`）のドラフト、`Future`/`Task` 二層構造と `run_stream_async` の導入方針を整理。
- `RunConfig`・`AsyncFeeder`・キャンセルモデルの整合性、監査ログ拡張の検討タスクを列挙。

### 6.3 データモデリングロードマップ
- `reml-data-modeling-roadmap.md` を策定し、品質DSL、統計型拡張、`Core.Config` 連携、ガバナンス/監査対応のロードマップをフェーズ別に提示。
- `QualityRule`/`QualityProfile`/`StatsProvider` といった API 草案、CLI 連携、既存仕様への更新対象を明確化。

### 6.4 制約DSLガイド強化
- `guides/constraint-dsl-best-practices.md` を追加し、標準APIで扱う制約とプラグイン領域の線引き、診断メッセージ設計、運用パターンを整理。
- `Constraint` 登録 API のメタデータ拡張や監査ログの統合手順といった今後のタスクをフォローアップ項目として列挙。

## 7. まとめ
- Reml のコア哲学に沿って、標準APIへ織り込む価値が高いパラダイムは「ストリーム／リアクティブ」「並行／Actor」「データ指向」の領域。
- 関数型・宣言型・制約系は既存機構の強化やガイド整備で対応可能。
- 機械学習やロジック完全対応は当面プラグイン・外部モジュールで扱う方針が適切。
- 次ステップでは優先領域ごとのAPI案と頭出し調査を進め、Remlの小さく強いコアを維持しつつ支援ラインを拡張する。
