{
  "diagnostics": [
    {
      "severity": "error",
      "message": "残余効果が閉じていません",
      "schema_version": "2.0.0-draft",
      "location": {
        "file": "<入力>",
        "line": 1,
        "column": 1,
        "endLine": 1,
        "endColumn": 1
      },
      "code": "effects.contract.residual_leak",
      "codes": [ "effects.contract.residual_leak" ],
      "domain": "type",
      "timestamp": "1970-01-01T00:00:00Z",
      "notes": [
        "`panic` のハンドラが宣言されていないためステージ検証に失敗しました"
      ],
      "extensions": {
        "diagnostic.v2": {
          "timestamp": "1970-01-01T00:00:00Z",
          "codes": [ "effects.contract.residual_leak" ]
        },
        "effects": {
          "stage": { "required": "stable", "actual": "stable" },
          "residual": { "missing": [ "panic" ], "leaked_from": "fn demo" },
          "declared": [ "io" ],
          "stage_trace": [
            { "source": "cli_option", "note": "not provided" },
            { "source": "env_var", "note": "REMLC_EFFECT_STAGE not set" },
            {
              "source": "typer",
              "stage": "stable",
              "capability": "core.runtime"
            },
            {
              "source": "runtime",
              "stage": "stable",
              "capability": "core.runtime"
            },
            {
              "source": "capability_json",
              "stage": "stable",
              "file": "tooling/runtime/capabilities/default.json"
            }
          ]
        },
        "effect.stage.required": "stable",
        "effect.stage.actual": "stable",
        "effect.stage.capability": "core.runtime",
        "effect.stage_trace": [
          { "source": "cli_option", "note": "not provided" },
          { "source": "env_var", "note": "REMLC_EFFECT_STAGE not set" },
          {
            "source": "typer",
            "stage": "stable",
            "capability": "core.runtime"
          },
          {
            "source": "runtime",
            "stage": "stable",
            "capability": "core.runtime"
          },
          {
            "source": "capability_json",
            "stage": "stable",
            "file": "tooling/runtime/capabilities/default.json"
          }
        ]
      },
      "audit_metadata": {
        "event.kind": "effects.contract.residual_leak",
        "event.domain": "type",
        "effect.residual.tags": [ "panic" ],
        "effect.capability": "core.runtime",
        "effect.stage.actual": "stable",
        "effect.stage.required": "stable",
        "effect.stage.capabilities": [
          { "capability": "core.runtime", "stage": "stable" }
        ],
        "effect.capabilities": [ "core.runtime" ],
        "stage_trace": [
          { "source": "typer", "stage": "stable" },
          { "source": "runtime", "stage": "stable" }
        ],
        "audit.policy.version": "phase2.5.audit.v1",
        "audit.channel": "cli",
        "audit.build_id": "19700101T000000Z",
        "audit.sequence": 0,
        "audit.source.workspace": ".",
        "cli.audit_id": "cli/19700101T000000Z#0",
        "schema.version": "1.1",
        "audit.timestamp": "1970-01-01T00:00:00Z",
        "cli.change_set": {
          "policy": "phase2.5.audit.v1",
          "origin": "cli",
          "source": {
            "build_id": "19700101T000000Z",
            "workspace": ".",
            "sequence": 0
          },
          "items": [ { "kind": "input", "path": "<入力>" } ]
        }
      },
      "audit": {
        "metadata": {
          "cli.change_set": {
            "policy": "phase2.5.audit.v1",
            "origin": "cli",
            "source": {
              "build_id": "19700101T000000Z",
              "workspace": ".",
              "sequence": 0
            },
            "items": [ { "kind": "input", "path": "<入力>" } ]
          },
          "cli.audit_id": "cli/19700101T000000Z#0",
          "audit.source.workspace": ".",
          "audit.sequence": 0,
          "audit.build_id": "19700101T000000Z",
          "audit.channel": "cli",
          "audit.policy.version": "phase2.5.audit.v1",
          "stage_trace": [
            { "source": "typer", "stage": "stable" },
            { "source": "runtime", "stage": "stable" }
          ],
          "effect.capabilities": [ "core.runtime" ],
          "effect.stage.capabilities": [
            { "capability": "core.runtime", "stage": "stable" }
          ],
          "effect.stage.required": "stable",
          "effect.stage.actual": "stable",
          "effect.capability": "core.runtime",
          "effect.residual.tags": [ "panic" ],
          "event.domain": "type",
          "event.kind": "effects.contract.residual_leak",
          "audit.timestamp": "1970-01-01T00:00:00Z",
          "schema.version": "1.1"
        },
        "audit_id": "cli/19700101T000000Z#0",
        "change_set": {
          "policy": "phase2.5.audit.v1",
          "origin": "cli",
          "source": {
            "build_id": "19700101T000000Z",
            "workspace": ".",
            "sequence": 0
          },
          "items": [ { "kind": "input", "path": "<入力>" } ]
        }
      }
    }
  ]
}
