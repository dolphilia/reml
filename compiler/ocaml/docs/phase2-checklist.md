# Phase 2 開始前チェックリスト

**作成日**: 2025-10-06
**チェック実施日**: __________
**チェック実施者**: __________

このチェックリストは、Phase 2（型推論実装）を開始する前に、必要な前提条件が満たされていることを確認するためのものです。

---

## 📋 環境確認

### 開発環境

- [ ] **OCaml バージョン確認**
  ```bash
  ocaml --version  # >= 4.14 (推奨: 5.2.1)
  ```

- [ ] **Dune バージョン確認**
  ```bash
  dune --version  # >= 3.0
  ```

- [ ] **Menhir バージョン確認**
  ```bash
  menhir --version  # >= 20201216
  ```

- [ ] **opam 環境の確認**
  ```bash
  opam switch list  # 現在の switch を確認
  opam list         # インストール済みパッケージを確認
  ```

### ビルドとテスト

- [ ] **クリーンビルドの成功**
  ```bash
  cd /Users/dolphilia/github/kestrel/compiler/ocaml
  dune clean
  dune build
  ```

- [ ] **全テストの成功**
  ```bash
  dune test
  ```
  - Lexer テスト: 50+ ケース → 全て成功
  - Parser テスト: 80+ ケース → 全て成功
  - パターンマッチテスト: 35+ ケース → 全て成功
  - ゴールデンテスト: 1 ケース → 成功

- [ ] **CLI の動作確認**
  ```bash
  dune exec -- remlc --emit-ast tests/simple.reml
  ```

---

## 📚 ドキュメント確認

### Phase 1 完了ドキュメント

- [ ] [phase1-completion-report.md](./phase1-completion-report.md) を読んだ
- [ ] [phase2-handover.md](./phase2-handover.md) を読んだ
- [ ] [technical-debt.md](./technical-debt.md) を読んだ

### 仕様書の理解

- [ ] **型システム仕様の理解**
  - [1-2-types-Inference.md](../../../docs/spec/1-2-types-Inference.md) を読んだ
  - Hindley-Milner 型推論の基本を理解した
  - 型変数、単一化、一般化の概念を理解した

- [ ] **エラー仕様の確認**
  - [2-5-error.md](../../../docs/spec/2-5-error.md) を読んだ
  - 型エラーメッセージの要件を理解した

- [ ] **構文仕様の復習**
  - [1-1-syntax.md](../../../docs/spec/1-1-syntax.md) を復習した
  - 型注釈の構文を理解した

### 計画書の確認

- [ ] **Phase 2 計画書の理解**
  - [1-2-typer-implementation.md](../../../docs/plans/bootstrap-roadmap/1-2-typer-implementation.md) を読んだ
  - M2 マイルストーンの達成条件を理解した
  - 作業ブレークダウンを確認した

- [ ] **全体計画の確認**
  - [1-0-phase1-bootstrap.md](../../../docs/plans/bootstrap-roadmap/1-0-phase1-bootstrap.md) を確認した
  - Phase 1 と Phase 2 の境界を理解した

---

## 🔧 技術的準備

### 既存コードベースの理解

- [ ] **AST 構造の理解**
  - `src/ast.ml` のデータ構造を理解した
  - 式、パターン、宣言、型注釈の型定義を把握した

- [ ] **Parser Driver の理解**
  - `src/parser_driver.ml` のインターフェースを理解した
  - パース結果の取得方法を把握した

- [ ] **診断システムの理解**
  - `src/diagnostic.ml` の使い方を理解した
  - エラーメッセージの生成方法を把握した

### Typed AST の設計準備

- [ ] **型定義の設計方針を決定**
  - Typed AST を別ファイル (`typed_ast.ml`) にするか、`ast.ml` に統合するか
  - 型情報の表現方法（型変数、型環境）

- [ ] **型推論エンジンの設計方針を決定**
  - Unification アルゴリズムの選定
  - 型環境の管理方法

### 参考資料の調査

- [ ] **型推論の参考実装を調査**
  - OCaml の型推論実装を参考にした
  - その他の言語実装（SML、Haskell）を調査した

- [ ] **型エラーメッセージのベストプラクティスを調査**
  - 他の言語の型エラーメッセージを調査した
  - ユーザーフレンドリーなエラーメッセージの書き方を学んだ

---

## 🎯 Phase 2 の目標確認

### マイルストーン M2 の理解

- [ ] **M2: Typer MVP の達成条件を理解**
  - HM 型推論（単相 + let 多相）の実装
  - [1-2-types-Inference.md](../../../docs/spec/1-2-types-Inference.md) のサンプルケースを再現
  - 型推論スナップショットテストの作成

- [ ] **期限目安の確認**
  - 開始後 8 週（Phase 1 開始から累計）
  - 現在の週数を確認した

### 成果物の明確化

- [ ] **実装する主要コンポーネントを理解**
  1. Typed AST 定義 (`src/typed_ast.ml`)
  2. 型推論エンジン (`src/type_inference.ml`)
  3. 型エラーメッセージ (`src/type_error.ml`)
  4. テストスイート (`tests/test_type_inference.ml`)

- [ ] **テスト方針の決定**
  - ユニットテストのカバレッジ目標
  - スナップショットテストの範囲
  - 型エラーケースのテスト方法

---

## 📝 作業計画の確認

### Week 1-2: Typed AST 設計

- [ ] **Week 1-2 のタスクを理解**
  - `src/typed_ast.ml` の設計と実装
  - 型環境の定義
  - 型変数の管理機構

- [ ] **必要なモジュールを特定**
  - 型定義に必要な OCaml モジュール
  - 型環境の実装に必要なデータ構造

### Week 3-4: 型推論コアの実装

- [ ] **Week 3-4 のタスクを理解**
  - Unification アルゴリズム
  - 基本的な型推論（リテラル、変数、関数適用）
  - let 多相の実装

### Week 5-6: エラーハンドリングとテスト

- [ ] **Week 5-6 のタスクを理解**
  - 型エラーメッセージの実装
  - 型推論テストスイートの作成
  - スナップショットテストの整備

### Week 7-8: 統合と品質保証

- [ ] **Week 7-8 のタスクを理解**
  - Parser との統合
  - CLI への型チェック機能追加
  - CI/CD への型テスト追加
  - ドキュメント整備

---

## 🚨 既知の問題の確認

### Phase 1 からの技術的負債

- [ ] **レコードパターンの複数アーム制限を理解**
  - 問題の詳細を把握した
  - Phase 2 Week 1-2 で対応予定

- [x] **Handler 宣言のパース問題を理解**（2025-10-06 時点で解消済み）
  - parser に `handler_entry` を導入し、テストを更新

- [ ] **Unicode XID 未対応を理解**
  - 現在の制限を把握した
  - Phase 2-3 で対応予定

---

## ✅ 最終確認

### チーム確認

- [ ] **役割分担の確認**
  - 型推論実装の担当者を決定した
  - レビュアーを決定した

- [ ] **コミュニケーション方法の確認**
  - 週次進捗報告の方法を決定した
  - 問題発生時のエスカレーション方法を確認した

### スケジュール確認

- [ ] **Phase 2 のスケジュールを確認**
  - 8 週間の作業計画を確認した
  - 各週のマイルストーンを理解した

- [ ] **Phase 2 完了基準を確認**
  - M2 マイルストーンの達成条件
  - テスト成功基準
  - ドキュメント整備基準

### リスク管理

- [ ] **潜在的なリスクを特定**
  - 型推論実装の複雑性
  - 既存コードとの統合の難しさ
  - スケジュール遅延のリスク

- [ ] **リスク対応計画を作成**
  - 各リスクの軽減策を検討した
  - エスカレーションパスを確認した

---

## 📊 チェック結果

### 全体スコア

- 環境確認: _____ / 7 項目
- ドキュメント確認: _____ / 10 項目
- 技術的準備: _____ / 8 項目
- Phase 2 の目標確認: _____ / 6 項目
- 作業計画の確認: _____ / 4 項目
- 既知の問題の確認: _____ / 3 項目
- 最終確認: _____ / 8 項目

**合計**: _____ / 46 項目

### 判定

- [ ] **Phase 2 開始可能** (40/46 以上)
- [ ] **追加準備が必要** (30-39/46)
- [ ] **Phase 2 開始不可** (30/46 未満)

### 備考

_____________________________________________________

_____________________________________________________

_____________________________________________________

---

**チェック完了日**: __________
**承認者**: __________
**Phase 2 開始日**: __________
