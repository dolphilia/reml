# JSON/TOML/XML 導入検討メモ

## 背景
- Reml のコア方針は「小さく強いコア」と宣言的 DSL による操作性および高品質な診断を重視することにある。[0-1-overview.md](0-1-overview.md)
- 標準仕様では設定・データ領域向けに Reml 方言の DSL を推進し、既存の YAML/JSON 代替を想定している。[2-7-config.md](2-7-config.md) / [2-8-data.md](2-8-data.md) / [scenario-requirements.md](scenario-requirements.md)
- CLI やランタイムの監査ログでは JSON 形式が共通メタデータとして利用されており、外部システムとの橋渡しが求められている。[2-5-error.md](2-5-error.md) / [guides/config-cli.md](guides/config-cli.md) / [guides/runtime-bridges.md](guides/runtime-bridges.md)

## 既存の取り組みと課題
- `Core.Config` と `Core.Data` はスキーマ定義・差分・検証を Reml DSL で完結させる戦略を示しており、JSON 等の直接サポートは補助的扱いになっている。
- 監査ログ・CLI 出力の JSON スキーマは定義済みだが、双方向に取り込むための正式なパーサ/エンコーダは未整理。
- XML/TOML のように仕様が複雑なフォーマットは、コア哲学と工数の観点で導入優先度が検討課題になっている。

## 導入メリット
- 監査ログや CLI で生成される JSON を公式コンポーネントで読み書きできれば、ツールチェーン間の整合性と変換コストを下げられる。
- 外部サービスが JSON/TOML/XML で設定やスキーマを提供するケースで、Reml DSL への橋渡しが容易になり、既存資産を活かした移行パスを提示できる。
- Core.Parse のリファレンス実装として公開すれば、複雑なデータ指向 DSL を組む際の設計例となり、学習・再利用価値が高まる。
- XML のストリーミングやトークン数が多いデータに対し、Packrat/左再帰切替など既存の実行戦略を実証するベンチマーク素材が得られる。

## デメリット・リスク
- JSON/TOML/XML は仕様更新が頻繁であり、Reml コアの最小主義やロードマップ上の優先課題（効果拡張、IDE 連携など）を圧迫する恐れがある。
- Reml 方言の設定 DSL を推進するプロジェクト方針と競合し、「Reml で置き換える」というメッセージが弱まる可能性がある。
- XML のネームスペースやエンコーディング等を高品質エラーとともにサポートするには大きな工数・テスト整備が必要で、`Diagnostic`/`audit_id` 規約への組み込みも負担となる。

## 実装方針の概案
- Core.Parse を活用した公式モジュールとして `Core.Parse.Json` / `Core.Parse.Toml` / `Core.Parse.Xml` を追加し、`Parser<T>` ベースで構文を実装する。Packrat・ストリーミング対応は `RunConfig` により切り替え可能にする。
- 文字列リテラルや Unicode エスケープ処理は `Core.Parse.Lex` の既存ユーティリティを再利用し、JSON の `\u{...}` などを Reml の文字モデルに沿って扱う。
- デコード結果は `Core.Config` / `Core.Data` のスキーマへ流し込む変換 API を用意し、監査ログや差分ワークフローと接続する。
- エンコード側は既存の構造化ログ規約に従い、`Diagnostic` / `change_set` / `audit_id` を自動付与するヘルパを提供する。

## 推奨ステップ
1. JSON を対象にした試作モジュールのスコープ（対応データ型、診断ポリシー、既知制約）を設計メモとして整理し、ロードマップに追加する。
2. PoC で `reml-config` / `reml-data` の JSON 入出力を新モジュール経由に置き換え、監査ログ互換性と性能を測定して導入可否を判断する。
3. TOML/XML については、JSON PoC の成果と開発コストを評価した上で、プラグインまたはオプションモジュールとして段階的導入を検討する。

## 補足
- 本メモは 2024/2025 時点の仕様書と `research-Reml-latest.md` の調査結果を基に整理した。今後のフェーズ更新や追加調査に応じて改訂すること。
