# 3.8 ドキュメント・仕様フィードバック計画

## 目的
- Phase 3 で Reml 実装特有の仕様変更・知見を言語仕様書へ反映し、セルフホスト化後のドキュメント整合を保つ。
- クロスコンパイル機能やランタイム更新で判明したギャップを `notes/llvm-spec-status-survey.md`・`notes/dsl-plugin-roadmap.md` 等へ連携し、Phase 4 の移行計画へ橋渡しする。

## スコープ
- **含む**: 実装差分の記録、仕様書更新提案、脚注/TODO の追加、関連ノートの更新、レビュー連携。
- **含まない**: 新規仕様章の全面改稿。必要な場合は別タスクを起票。
- **前提**: Phase 3 の各実装タスクからフィードバックが集まる仕組みがあり、差分が明確化していること。

## 作業ブレークダウン

### 1. 差分収集とトリアージ（67-68週目、3-7と並行）
**担当領域**: 実装フィードバックの集約

1.1. **実装タスクからの差分収集**
- 3-1（Parser 移植）からの差分: ストリーミング API、Unicode モデル、エラーハンドリング
- 3-2（TypeChecker 移植）からの差分: 型推論、型クラス、効果システム
- 3-4（CodeGen 移植）からの差分: IR 設計、LLVM 生成、最適化
- 3-5（Runtime 統合）からの差分: Capability システム、Stage 検証、メモリ管理

1.2. **差分の分類と優先度付け**
- **Critical**: 仕様矛盾、動作不整合、セキュリティ影響
- **High**: API 変更、新機能追加、性能改善
- **Medium**: ドキュメント改善、サンプル追加、用語統一
- **Low**: 脚注追加、参照リンク、軽微な修正

1.3. **差分リスト作成**
- スプレッドシート or Markdown テーブルでの管理
- 差分 ID、カテゴリ、影響範囲、担当者、ステータスを記録
- 関連する仕様書ファイルのマッピング
- 期限設定（Phase 3 完了前 vs Phase 4 持ち越し）

1.4. **ステークホルダー確認**
- 各実装タスク担当者へのヒアリング
- 未記録の知見・TODOの掘り起こし
- 優先度の合意形成
- 週次進捗会議での共有

**成果物**: 差分リスト、優先度分類、影響範囲マップ

### 2. 仕様書更新案の作成（68-69週目）
**担当領域**: 仕様変更のドラフト

2.1. **Chapter 1（言語コア）への反映**
- `1-1-syntax.md`: 構文追加・変更、演算子優先順位の調整
- `1-2-types-Inference.md`: 型推論規則の明確化、型クラス制約の詳細化
- `1-3-effects-safety.md`: 効果システムの実装差分、Stage 検証ルール
- `1-4-test-unicode-model.md`: Unicode 処理の実装知見、バグ修正

2.2. **Chapter 2（Parser API）への反映**
- `2-1-parser-type.md`: Parser 型の調整、入力モデルの拡張
- `2-2-core-combinator.md`: コンビネーターの追加・変更
- `2-5-error.md`: エラーハンドリングの改善、診断フォーマット
- `guides/core-parse-streaming.md`: ストリーミング API の実装詳細

2.3. **Chapter 3（標準ライブラリ）への反映**
- `3-6-core-diagnostics-audit.md`: Diagnostic/AuditEnvelope の実装差分
- `3-8-core-runtime-capability.md`: Capability/Stage の実装詳細
- `3-9-core-async-ffi-unsafe.md`: FFI 契約、所有権モデルの明確化
- `3-10-core-env.md`: 環境変数・システム情報の API 調整

2.4. **修正案のレビュー準備**
- 各修正案の diff 形式での提示
- 変更理由と実装根拠の記述
- 影響範囲の明示（互換性、依存関係）
- サンプルコードの更新案

**成果物**: 仕様書更新 PR ドラフト、変更理由書、影響分析

### 3. レビュープロセス運用（69-70週目）
**担当領域**: 品質保証とガバナンス

3.1. **レビュー体制の整備**
- 領域別レビュア割当（Parser/Type/Runtime/Toolchain）
- レビュー頻度の設定（週次または隔週）
- レビュー基準の明確化（技術的正確性、可読性、一貫性）
- レビューツールの選定（GitHub PR、専用ツール等）

3.2. **レビューサイクル実行**
- PR 作成とレビュア割当
- レビューコメントの収集と議論
- 修正反映とレビュー再依頼
- 承認後のマージと記録

3.3. **承認記録の管理**
- `0-3-audit-and-metrics.md` への記録
- 承認日時、レビュア名、承認コメント
- 未承認項目の追跡
- エスカレーション手順（意見不一致時）

3.4. **継続的フィードバック**
- Phase 3 進行中の差分追加受付
- 緊急修正のファストトラック
- 週次レビュー会議での進捗確認
- ブロッカーの早期解消

**成果物**: レビュー済み仕様書更新、承認記録、レビューログ

### 4. ノート・調査資料の更新（70-71週目）
**担当領域**: 技術知見の蓄積

4.1. **LLVM 仕様調査ノート更新**
- `notes/llvm-spec-status-survey.md` への Phase 3 知見追記
- LLVM IR 生成の実装パターン
- ABI 差分の詳細記録
- 最適化オプションの効果測定結果

4.2. **DSL・プラグインロードマップ更新**
- `notes/dsl-plugin-roadmap.md` への Phase 3 フィードバック
- プラグイン API の実装状況
- 拡張ポイントの追加・変更
- Phase 4 以降での本格対応計画

4.3. **クロスコンパイル仕様更新**
- `notes/cross-compilation-spec-intro.md` または関連ノートの更新
- ターゲット別の実装差分
- クロスビルドの課題と解決策
- 将来ターゲット（WASM 等）の検討事項

4.4. **新規調査ノートの作成**
- 必要に応じて `notes/self-host-lessons-learned.md` 等を新規作成
- セルフホスト化での技術的発見
- パフォーマンス最適化の知見
- Phase 4 への引き継ぎ事項

**成果物**: 更新済みノート、新規調査資料、知見データベース

### 5. 索引・相互参照の整備（71-72週目）
**担当領域**: ドキュメント整合性

5.1. **README.md の更新**
- 仕様書リストの最新化
- Phase 3 で追加・変更された章の反映
- リンク切れの修正
- セクション構成の見直し

5.2. **0-0-overview.md の更新**
- 言語概要の最新化（Phase 3 実装反映）
- 主要機能の追加・修正
- アーキテクチャ図の更新（必要に応じて）
- 参照リンクの整合

5.3. **相互参照の検証**
- 仕様書間のリンク（相対パス）の検証
- 削除・移動されたセクションへのリンク修正
- 自動リンクチェックツールの活用（`markdown-link-check` 等）
- ブロークンリンクの修正

5.4. **用語統一の確認**
- `0-2-glossary.md` との整合性確認
- 新規用語の追加
- 表記ゆれの統一（例: "パーサ" vs "パーサー"）
- 外来語の原語併記ルールの徹底

**成果物**: 更新済み索引、リンク検証レポート、用語集更新

### 6. サンプルコードの検証と更新（72-73週目）
**担当領域**: 実例の整合性

6.1. **仕様書内サンプルの検証**
- 各章のサンプルコードを Phase 3 実装で実行
- 動作確認とエラー修正
- 出力結果の更新（実際の挙動に合わせる）
- 非推奨機能の削除または明示

6.2. **samples/ ディレクトリの整備**
- `samples/language-impl-comparison/` の更新
- Phase 3 新機能のサンプル追加
- ゴールデンテスト用サンプルの拡充
- README の更新

6.3. **guides/ のサンプル更新**
- `guides/llvm-integration-notes.md` 等のコード例更新
- 実装差分に基づく修正
- 新規ガイドのサンプル作成
- コメントの充実

6.4. **自動検証の導入**
- サンプルコードの CI 統合
- 定期的な実行テスト
- エラー検出の自動化
- Phase 4 以降での継続運用

**成果物**: 検証済みサンプル、自動検証システム、サンプル実行レポート

### 7. Phase 4 引き継ぎ資料作成（73週目）
**担当領域**: 次フェーズへの橋渡し

7.1. **未解決事項の整理**
- Phase 3 で解決できなかった仕様ギャップ
- Phase 4 で対応すべき TODO リスト
- 技術的負債の明示
- 優先度と期限の提案

7.2. **引き継ぎドキュメント作成**
- Phase 4 担当者向けの概要資料
- 重要な実装差分のサマリ
- レビュー済み vs 未レビュー項目の一覧
- 連絡窓口と引き継ぎミーティングの設定

7.3. **0-4-risk-handling.md への記録**
- Phase 3 で発生したリスクと対応
- Phase 4 へ持ち越すリスク項目
- 継続監視が必要な事項
- エスカレーション履歴

7.4. **新規 TODO ノートの作成**
- 必要に応じて `notes/phase4-todo.md` 等を作成
- カテゴリ別の TODO リスト
- 担当者候補の記載
- Phase 4 計画書との連携

**成果物**: 引き継ぎ資料、未解決事項リスト、Phase 4 TODO ノート

### 8. 最終レビューとマージ（74週目）
**担当領域**: 品質保証と公開

8.1. **最終レビュー実施**
- 全仕様書更新の統合レビュー
- 整合性の最終確認（相互参照、用語、サンプル）
- レビュアによる最終承認
- 未承認項目の Phase 4 延期判断

8.2. **マージと公開**
- main ブランチへのマージ
- バージョンタグの付与（v3.0-spec 等）
- 変更履歴の記録（CHANGELOG.md）
- コミュニティへの告知準備

8.3. **メトリクス記録**
- `0-3-audit-and-metrics.md` への最終記録
- 仕様更新件数、レビュー時間、承認率
- サンプル検証結果
- 未解決事項の数と分類

8.4. **レビュー資料作成**
- Phase 3 仕様フィードバックサマリ
- 主要な変更点のハイライト
- Phase 4 への影響分析
- M6 マイルストーン達成報告の一部として提出

**成果物**: 公開済み仕様書、変更履歴、メトリクス記録、サマリレポート

## 成果物と検証
- 仕様更新の差分がレビューを通過し、履歴が残る。
- ノート類が最新状態になり、フェーズ間の引き継ぎが明瞭。
- 索引のリンクが正しく更新され、リンク切れが無い。

## リスクとフォローアップ
- レビュー負荷が高い場合は更新を段階的に分割し、最重要項目から着手。
- 大きな仕様変更が必要な場合は Phase 4 のロードマップに組み込み、読者へ影響範囲を通知。
- ノートの散逸を防ぐため、更新履歴を `0-3-audit-and-metrics.md` で管理。

## 参考資料
- [3-0-phase3-self-host.md](3-0-phase3-self-host.md)
- [0-0-overview.md](../../0-0-overview.md)
- [0-3-audit-and-metrics.md](0-3-audit-and-metrics.md)
- [0-4-risk-handling.md](0-4-risk-handling.md)
- [notes/llvm-spec-status-survey.md](../../notes/llvm-spec-status-survey.md)
- [notes/dsl-plugin-roadmap.md](../../notes/dsl-plugin-roadmap.md)

